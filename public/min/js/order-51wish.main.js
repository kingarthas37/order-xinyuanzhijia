require=function e(n,a,t){function o(r,c){if(!a[r]){if(!n[r]){var l="function"==typeof require&&require;if(!c&&l)return l(r,!0);if(i)return i(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var s=a[r]={exports:{}};n[r][0].call(s.exports,function(e){var a=n[r][1][e];return o(a?a:e)},s,s.exports,e,n,a,t)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<t.length;r++)o(t[r]);return o}({5:[function(e,n,a){"use strict";e("../../../js/main"),e("./config"),e("./common"),e("./utils")},{"../../../js/main":22,"./common":3,"./config":4,"./utils":6}],4:[function(e,n,a){"use strict";window.assets={"no-image-src":"//lc-JoaBcRTt.cn-n1.lcfile.com/d4c225054f005a4d7d39.png"};var t="order-51wish";window.env=function(){return location.hostname===t+".leanapp.cn"||location.hostname===t+".cn"||location.host==="www."+t+".cn"?"production":location.hostname==="stg-"+t+".leanapp.cn"?"stage":"development"};var o=function(){return"production"===env()?"//order-51wish.leanapp.cn/1.1/functions/":"stage"===env()?"//stg-order-51wish.leanapp.cn/1.1/functions/":"/1.1/functions/"};window.leanApp={appdId:"JoaBcRTtJUNAV1bLpqv8z1ze-gzGzoHsz",api:"https://leancloud.cn/1.1/",cloud:o()},window.leanAppHeader={"x-lc-id":leanApp.appdId,"x-lc-sign":$.cookie("x_lc_sign")||"","x-lc-session":$.cookie("x_lc_session")||"","x-lc-prod":"production"===env()?1:0,"content-type":"application/json"}},{}],3:[function(e,n,a){"use strict";var t=e("amazeui");$(function(){!function(){for(var e,n=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],t=a.length,o=window.console=window.console||{};t--;)e=a[t],o[e]||(o[e]=n)}(),$.extend($.validator.messages,{required:"必选字段",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",maxlength:jQuery.validator.format("请输入一个 长度最多是 {0} 的字符串"),minlength:jQuery.validator.format("请输入一个 长度最少是 {0} 的字符串"),rangelength:jQuery.validator.format("请输入 一个长度介于 {0} 和 {1} 之间的字符串"),range:jQuery.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:jQuery.validator.format("请输入一个最大为{0} 的值"),min:jQuery.validator.format("请输入一个最小为{0} 的值")}),t.plugin("amuiSelected",t.selected),$("[data-am-selected]").amuiSelected(),$(".am-alert.am-alert-success").length&&setTimeout(function(){$(".am-alert.am-alert-success").fadeOut()},3e3),$(".image-convert").click(function(){var e=$("#modal-image-convert");if(!e.length){$("body").append('\n                <div class="am-modal am-modal-no-btn" tabindex="-1" id="modal-image-convert">\n                  <div class="am-modal-dialog">\n                    <div class="am-modal-hd">图片在线转换\n                      <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>\n                    </div>\n                    <div class="am-modal-bd">\n                        <form class="am-form t-l">\n                            <div class="am-form-group">\n                              <input type="text" id="input-image-convert" class="am-form-field" placeholder="输入需要转换的图片Url"/>\n                            </div> \n                            <button type="button" class="am-btn am-btn-primary">开始转换</button>\n                            <span class="info"></span>\n                        </form>\n                    </div>\n                  </div>\n                </div>\n            '),e=$("#modal-image-convert");var n=e.find(".am-form-field"),a=e.find(".am-btn"),t=e.find(".info");a.click(function(){var e=$.trim(n.val());return e?/(\.jpg|\.jpeg|\.png|\.gif)/.test(e)?(a.prop("disabled",!0).text("正在转换中..."),t.text(""),void $.ajax({url:"/file-manage/upload/auto",type:"post",data:{"img-url":e}}).then(function(e){e.success?(t.text("转换成功!"),a.prop("disabled",!1).text("开始转换"),n.val(e.url),n[0].focus(),n.select()):t.text("转换失败!")})):(n.val(""),n[0].focus(),!1):(n[0].focus(),!1)})}e.modal(),e.find(".am-form-field").val("").get(0).focus(),e.find(".info").text("")})})},{amazeui:9}]},{},[5]);
require=function t(e,n,r){function i(o,c){if(!n[o]){if(!e[o]){var s="function"==typeof require&&require;if(!c&&s)return s(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[o]={exports:{}};e[o][0].call(d.exports,function(t){var n=e[o][1][t];return i(n?n:t)},d,d.exports,t,e,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({8:[function(t,e,n){"use strict";t("../../../js/main"),t("./index"),t("./sign"),t("./product"),t("./book"),t("./music"),t("./purchase"),t("./customer"),t("./order"),t("./earning"),t("./spent"),t("./remark"),t("./product-method"),t("./product-category"),t("./taobao-mail-create"),t("./product-book"),t("./product-brand"),t("./record"),t("./record-category"),t("./identity"),t("./file-manage"),t("./ship-order")},{"../../../js/main":22,"./book":"book","./customer":"customer","./earning":"earning","./file-manage":"file-manage","./identity":"identity","./index":"index","./music":"music","./order":"order","./product":"product","./product-book":"product-book","./product-brand":"product-brand","./product-category":"product-category","./product-method":"product-method","./purchase":"purchase","./record":"record","./record-category":"record-category","./remark":"remark","./ship-order":"ship-order","./sign":"sign","./spent":"spent","./taobao-mail-create":"taobao-mail-create"}],"taobao-mail-create":[function(t,e,n){"use strict";var r=(t("swfobject"),t("flash-detect"));e.exports=function(){function t(t){t=$.trim(t),t.replace(/#{4,6}([^\n]+)\n((?:[^#####])+)/g,function(t,e,n){var r={};return r.title=encodeURIComponent($.trim(e)),n=$.trim(n),n=n.replace(/(http[^密]*)/g,function(t,e){return e=$.trim(e),'<a target="_blank" href="'+e+'">'+e+"</a> "}),n=n.replace(/(密码[^\n]+)/g,function(t,e){return e+"<br/>"}),r.content=encodeURIComponent(n),p.push(r),""})}function e(t){t=$.trim(t),t=t.replace(/\n/g,"|");var e=t.split("|"),r=$.grep(e,function(t,e){return t});/订单号/.test(t)&&(f=/订单号: [^\d]*(\d+)/.exec(t)[1]),h=r[4],$.each(r,function(t,e){$.each(p,function(t,n){return encodeURIComponent($.trim(e))==n.title?void m.push(n):void 0})}),n()}function n(){d.load("/assets/templates/taobao-mail.html",function(t){if(!m.length)return alert("数据错误，请检查!"),!1;u.text(a+"-"+decodeURIComponent(m[0].title)+(m.length>1?"等多件":""));var e=d.find(".mail-mx-title").empty(),n=d.find(".mail-mx-content").empty(),r='亲爱的 <strong style="color:#645a7e;">'+(h?h:"")+"</strong> "+(f?"(订单号"+f+")":"")+",以下为您拍下的宝贝:";e.html(r);for(var i="",o=0;o<m.length;o++){i+='<div style="border-bottom: 1px dashed #ccc; margin-bottom: 5px;">',i+='<div style="font-weight: bold; padding:5px; margin:0; ">'+(o+1)+"."+decodeURIComponent(m[o].title)+"</div>";var c=decodeURIComponent(m[o].content);c=c.replace(/\<a/gi,'<a style="color:#645a7e; text-decoration: underline;"'),c=c.replace(/链接\S/g,'<br/>下载链接:<span style="padding-left:6px;"></span>'),c=c.replace(/密码\S([^\n]+)/gi,'<br/>下载密码:<strong style="color:#645a7e;padding-left:6px;">$1</strong><div style="padding-bottom: 6px;"></div>'),i+='<div style="padding:5px; margin:0;">'+c+"</div>",i+="</div>"}n.html(i),n.find("> div:last").css({border:"none",margin:"0"})})}function i(t){l.show().text(t),setTimeout(function(){return l.hide()},3e3)}var a="暮雪的心愿城",o=null,c=$("#btn-create"),s=$("#textarea"),u=$(".mail-title"),d=$(".mail-content"),l=$(".copy-info"),p=[],f="",h="",m=[];if(s[0].focus(),$.ajax({url:"/mail/taobao-mail-create/get-content",success:function(e){t(e.content),c.removeAttr("disabled")},error:function(t,e,n){alert("数据加载出错，请重新刷新页面!("+t+e+n+")")}}),c.click(function(){o=e(s.val())}),r.installed){var v="/assets/swf/ZeroClipboard.swf";$(".copy-title").show().zclip({path:v,copy:function(){return $(".mail-title").text()},afterCopy:function(){i("复制邮件标题成功")}}),$(".copy-wangwang").show().zclip({path:v,copy:function(){return"亲,商品已发送至您此邮箱,请注意查收! ps:如果您是手机端阅读(尤其是iPhone/iPad),请花30秒时间点击下邮件里的在手机中阅读的链接说明,希望本店商品能对亲有帮助哦,并祝亲能收获满满,心想事成,加油!!"},afterCopy:function(){i("复制旺旺回复内容成功!"),setTimeout(function(){location.reload()},1e3)}}),$(".copy-haoping").show().zclip({path:v,copy:function(){return'亲,我们已收到您的好评,感谢您对本店的支持,本店会一如既往地为您服务并会持续上架您喜欢的商品,请继续关注我们哦!以下是店主作为答谢赠送您的"天使音乐":[身体工房馆-天使疗愈花园-召唤天使] 下载链接: http://pan.baidu.com/s/1i31U9VJ 密码: 6882'},afterCopy:function(){i("复制好评回复内容成功")}}),$(".copy-howmail").show().zclip({path:v,copy:function(){return"亲,请问邮箱是多少,我这边可以给亲发货哦"},afterCopy:function(){i("复制询问邮箱成功!")}}),$(".copy-howread").show().zclip({path:v,copy:function(){return"亲此商品为电子版,拍时请留言备注自己的邮箱号,我会把百度云的下载链接发到亲的邮箱里,亲可以保存到自己的百度云或直接下载"},afterCopy:function(){i("复制如何阅读成功!")}}),$(".copy-sendremind").show().zclip({path:v,copy:function(){return"亲你这边一直没有回复我邮箱,我先把下载链接发给亲,如果亲有问题可以再跟我确认哦"},afterCopy:function(){i("复制发货提醒成功!")}})}}},{"flash-detect":12,swfobject:23}],spent:[function(t,e,n){"use strict";t("jquery-validate"),e.exports={indexFun:function(){var t=0;$(".cell-user1").each(function(e,n){t+=Number($(n).text())});var e=0;$(".cell-user2").each(function(t,n){e+=Number($(n).text())});var n=0;$(".cell-user3").each(function(t,e){n+=Number($(e).text())});var r=0;$(".cell-user4").each(function(t,e){r+=Number($(e).text())}),$("#total-user1").text(t.toFixed(2)),$("#total-user2").text(e.toFixed(2)),$("#total-user3").text(n.toFixed(2)),$("#total-user4").text(r.toFixed(2)),$("#total-spent").text((t-e-n-r).toFixed(2))},editFun:function(){$("#form-edit-earning").validate(),$("#spent-user1-comment,#spent-user2-comment,#spent-user3-comment,#spent-user4-comment").change(function(){var t=0,e=$(this).parent().prev().prev().find("input[type=text]"),n=this.value.match(/\\([^\n]+)/g);if(!n)return void e.val(0);for(var r=0;r<n.length;r++)n[r]=n[r].replace("\\",""),n[r]=$.trim(n[r]),t+=Number(n[r]);e.val(t.toFixed(2))})}}},{"jquery-validate":19}],sign:[function(t,e,n){"use strict";t("jquery-validate"),e.exports={loginFun:function(){$("#form-login").validate()},registerFun:function(){$("#form-register").validate()}}},{"jquery-validate":19}],"ship-order":[function(t,e,n){"use strict";t("jquery-validate"),t("jquery-form");t("async");e.exports={indexFun:function(){function t(t){return/^8235/.test(t)||/^YT/.test(t)?"YTO":/^73/.test(t)?"ZTO":/^56/.test(t)?"HTKY":/^52/.test(t)?"HTKY":/^221/.test(t)?"STO":/^SF/.test(t)?"SFEXPRESS":"ems"}var e=$("#modal-copy"),n=$("#modal-loading"),r=$(".select-order-copy-count"),i=$(".ckb-order-child");$(".copy-ship-order").click(function(){var t=$(this).data("id"),a=$(this).parents("tr").attr("data-id");e.modal({relatedTarget:this,onConfirm:function(e){function o(){if(c===s)return n.modal("close"),location.reload(),!1;c++;var e={countName:10>c?"0"+c:c,isChildOrder:i.prop("checked"),parentDataId:a};$.ajax({url:"/ship-order/copy/"+t,data:e,method:"post",success:function(t){o()}})}var c=0,s=parseInt(r.val());n.modal(),o()}})}),$(".remove-ship-order").click(function(){if(confirm("确认删除？")){var t=$(this).data("id");$.ajax({url:"/ship-order/remove/"+t,method:"post",success:function(t){location.reload()}})}}),$(".ckb-is-haiguan").click(function(){var t=$(this).parents("tr"),e=$(this).data("id"),n="isHaiguan",r=this.checked?"true":"false";$.ajax({url:"/ship-order/updateOrderStatus/"+e+"/"+n+"/"+r,method:"post"}).done(function(){if("true"===r&&t.hasClass("child")){var e=$(".am-table").find("tr[data-id="+t.attr("parent-data-id")+"]");e.find(".ckb-is-haiguan").prop("checked")||e.find(".ckb-is-haiguan").click()}})}),$(".ckb-is-arrived").click(function(){var t=$(this).parents("tr").find(".ckb-is-haiguan");t[0].checked||t.click();var e=$(this).data("id"),n="isArrived",r=this.checked?"true":"false";$.ajax({url:"/ship-order/updateOrderStatus/"+e+"/"+n+"/"+r,method:"post",success:function(t){t.success&&("true"===r?alert("已确认签收!"):alert("取消签收"))}})});var a=$(".am-table");$.cookie("hide-arrived-order")&&($(".hide-arrived-order").prop("checked",!0),a.find("tbody tr").each(function(t,e){$(e).find(".ckb-is-arrived")[0].checked&&$(e).addClass("hide")})),$(".hide-arrived-order").click(function(){this.checked?($.cookie("hide-arrived-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),a.find("tbody tr").each(function(t,e){$(e).find(".ckb-is-arrived")[0].checked&&$(e).addClass("hide")})):($.cookie("hide-arrived-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),a.find("tr.hide").removeClass("hide"))}),$(".clipboard-order").each(function(t,e){var n=this,r=new Clipboard(this);r.on("success",function(){$(n).addClass("active")})}),$(".clipboard-tracking").each(function(t,e){var n=this,r=new Clipboard(this);r.on("success",function(){$(n).addClass("active")})});var o=$("#modal-edit-tracking"),c=$("#input-edit-tracking");$(".edit-tracking").each(function(t,e){$(this).click(function(){setTimeout(function(){c.val(""),c[0].focus()},100),o.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).data("id"),n=$(this.relatedTarget).parents("tr"),r=n.find(".search-tracking");$.ajax({url:"/ship-order/edit-tracking/"+e,type:"post",data:{value:$.trim(c.val())},success:function(t){r.attr("data-tracking",$.trim(c.val())),r.text($.trim(c.val())),n.find(".ckb-is-haiguan")[0].checked||n.find(".ckb-is-haiguan").click()}})}})})});var s=$("#modal-edit-remark"),u=$("#input-edit-remark");$(".edit-remark").click(function(){var t=$(this).parents("tr");setTimeout(function(){u.val($.trim(t.find(".remark").text())),u[0].focus()},100),s.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).parents("tr"),n=$(this.relatedTarget).attr("data-id"),r=e.find(".remark");$.ajax({url:"/ship-order/edit-remark/"+n,type:"post",data:{value:$.trim(u.val())},success:function(t){r.attr("data-remark",$.trim(u.val())),r.text($.trim(u.val()))}})}})});var d=$("#modal-edit-ship-order"),l=$("#input-edit-ship-order");$(".edit-ship-order").click(function(){var t=$(this).parents("tr");setTimeout(function(){l.val($.trim(t.find(".ship-order-number").text())),l[0].focus()},100),d.modal({relatedTarget:this,onConfirm:function(t){var e=$(this.relatedTarget).parents("tr"),n=$(this.relatedTarget).attr("data-id"),r=e.find(".ship-order-number");$.ajax({url:"/ship-order/edit-ship-order-number/"+n,type:"post",data:{value:$.trim(l.val())},success:function(t){r.text($.trim(l.val()))}})}})});var p=$("#modal-loading"),f=$("#modal-tracking-info");$(".am-table").on("click",".search-tracking",function(){var e=$(this).text();$(this).addClass("active"),p.modal();var n=t(e);$.ajax({url:"/ship-order/express/"+e+"/"+n,type:"get",success:function(t){if(p.modal("close"),!t.list)return f.find(".am-modal-bd").html("<p>"+t.msg+"</p>"),f.modal(),!1;var e="";$.each(t.list,function(t,n){e+="<p><strong>"+n.time+"</strong> "+n.status+"</p>"}),f.find(".am-modal-bd").html(e),f.modal()}})});var h=$(".am-table");$(".search-child-tracking").click(function(){var e=$(this).parents("tr"),n=e.attr("data-id");e.find(".open-child-order i").hasClass("am-icon-plus-square-o")&&!e.find(".ckb-is-arrived").prop("checked")&&e.find(".open-child-order").click(),h.find("tr[parent-data-id="+n+"]").each(function(e,n){if($(n).find(".show-name.on").length)return void $(this).find(".show-name").click().removeClass("on");if(!$(n).find(".ckb-is-arrived").prop("checked")&&$(n).find(".search-tracking").text().length){var r=$(n).find(".search-tracking").text(),i=$(n).find(".show-name"),a=t(r);$.ajax({url:"/ship-order/express/"+r+"/"+a,type:"get",success:function(t){t.list?i.popover({content:"<p><strong>"+t.list[0].time+"</strong> "+t.list[0].status+"</p>"}):i.popover({content:"无查询信息"}),i.addClass("on").click()}})}})}),$(".search-all-tracking").click(function(){$(".search-tracking").each(function(e,n){var r=$(n).parents("tr");if(!r.hasClass("hide")&&$(n).attr("data-tracking")){var i=$(n).attr("data-tracking"),a=t(i);$.ajax({url:"/ship-order/express/"+i+"/"+a,type:"get",success:function(t){return t.list?void $(n).addClass("has-tracking"):($(n).addClass("no-tracking"),!1)}})}})}),$(".open-child-order").click(function(){var t=$(this).parents("tr"),e=t.data("id"),n=$(".am-table");$(this).find("i").hasClass("am-icon-plus-square-o")?($(this).find("i").removeClass("am-icon-plus-square-o").addClass("am-icon-minus-square-o"),t.data("is-expand")?n.find("tr[parent-data-id="+e+"]").addClass("on"):(n.find("tr[parent-data-id="+e+"]").each(function(e,n){$(this).addClass("on"),t.after(n)}),t.data("is-expand",!0))):($(this).find("i").removeClass("am-icon-minus-square-o").addClass("am-icon-plus-square-o"),n.find("tr[parent-data-id="+e+"]").removeClass("on"),n.find("tr[parent-data-id="+e+"]").find(".show-name.on").click())});var m=$(".copy-yuntao-code"),v=new Clipboard(m[0],{text:function(){return"\n                        var arr = [];\n                        arr.push($.trim($('.text-left').eq(0).text()));\n                        arr.push(location.href);\n                        arr.push($.trim($('.col-sm-9.text-left').eq(7).text()));\n                        arr.push(/单号为([a-zA-Z0-9]+)/.exec($('.table').eq(3).find('tr:last').text())[1]);\n                        arr.join();\n                    "}});v.on("success",function(){m.addClass("active")});var g=$(".am-table"),y=$("#modal-check-yuntao-code"),k=$(".input-check-yuntao-code"),b=$(".btn-check-yuntao-code"),x=$(".btn-go-yuntao-code");$(".check-yuntao-code").click(function(){y.modal(),k.val(""),setTimeout(function(){k[0].focus()},1)}),k.change(function(){var t=$.trim(k.val());k.val(t.replace('"',"").replace('"',""))}),b.click(function(){var t=k[0].value.split(","),e=t[0],n=$(".ship-order-number");n.each(function(t,r){if(t===n.length-1)return alert("匹配失败，无运淘订单记录!"),!1;if($(this).text()==e){var i=$(this).parents("tr"),a=i.attr("parent-data-id");i.addClass("bold");var o=k.val();return k.val(i.attr("data-ship-order-id")+","+o),g.find("tr[data-id="+a+"]").find(".open-child-order").find(".am-icon-plus-square-o").parent().click(),$("html,body").animate({scrollTop:i.offset().top-50}),!1}})}),x.click(function(){var t=k.val().split(","),e=g.find("tr[data-ship-order-id="+t[0]+"]");$.ajax({url:"/ship-order/go-yuntao-code",type:"post",data:{shipOrderId:t[0],link:t[2],name:t[3],trackingNumber:t[4]},success:function(n){e.removeClass("bold"),e.find(".td-name").html('<span clas="show-name">'+t[3]+"</span>"),e.find(".td-link").html('<a href="'+t[2]+'" target="_blank">链接</a>'),e.find(".td-tracking-number").html('\n                            <a href="javascript:;" title="查询快递" class="search-tracking" data-tracking="'+t[4]+'">'+t[4]+"</a>\n                         \n                        "),e.find(".ckb-is-haiguan").prop("checked")||e.find(".ckb-is-haiguan").click(),n.success?(alert("执行成功!"),y.modal("close")):alert("执行失败!")}})})},addFun:function(){$("#transferOrderNumber")[0].focus()}}},{async:1,"jquery-form":15,"jquery-validate":19}],remark:[function(t,e,n){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".ckb-is-complete").click(function(){var t=$(this);$.ajax({url:"/remark/complete",data:{remarkId:t.attr("data-id"),checked:t.prop("checked")},success:function(t){console.info(t)}})}),$(".remove-remark").click(function(){var t=$(this);return $("#confirm-remove-remark").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-all-remark").click(function(){this.checked?location.href="/remark?view=all":location.href="/remark"})},addFun:function(){$("#form-add-remark").validate()},editFun:function(){$("#form-edit-remark").validate()}}},{"jquery-validate":19}],"record-category":[function(t,e,n){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".remove-record-category").click(function(){var t=$(this);return $("#confirm-remove-record-category").modal({relatedTarget:this,onConfirm:function(){$.ajax({url:"/record-category/remove/"+t.attr("data-id"),success:function(t){if(t.success)return location.href="/record-category";var e=$("#alert-remove-record-category");e.find(".am-modal-bd").text(t.msg),e.modal({relatedTarget:this})}})},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-record-category").validate()},editFun:function(){$("#form-edit-record-category").validate()}}},{"jquery-validate":19}],record:[function(t,e,n){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".select-record-category").change(function(){this.value>0&&(location.href="/record?recordCategoryId="+this.value)}),$(".remove-record").click(function(){var t=$(this);return $("#confirm-remove-record").modal({relatedTarget:this,onConfirm:function(){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-record").validate()},editFun:function(){$("#form-edit-record").validate()},uploadImg:function(){var t=$("#form-upload-img"),e=$("#icon-image"),n=$(".upload-loading");t.submit(function(){return n.addClass("on"),$(this).ajaxSubmit({success:function(t){n.removeClass("on"),t.success?window.parent.uploadImgResponse(t.url):window.parent.uploadImgError(t.error)}}),!1}),e.change(function(){t.submit()})},uploadImgResponse:function(t){$("#image").val(t),$(".show-image").html('<img src="'+t+'"/>')},uploadImgError:function(t){var e=$("#alert-image-upload-error");e.find(".am-modal-bd").text(t),e.modal()}}},{"jquery-form":15,"jquery-validate":19}],purchase:[function(t,e,n){"use strict";t("jquery-validate");var r=t("bloodhound"),i=t("../common/utils");e.exports={indexFun:function(){$(".remove-purchase").click(function(){var t=$(this);return $("#confirm-remove-purchase").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-shipping-status-shipped").click(function(){var t=this,e=$(this).parents("tr");$.ajax({url:"/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"shipped":"notshipped"}}).done(function(){t.checked?e.addClass("off-middle"):e.removeClass("off").removeClass("off-middle")})}),$(".ckb-shipping-status-forward").click(function(){var t=this,e=$(this).parents("tr");this.checked?e.find(".ckb-shipping-status-shipped").prop("checked",!0):(e.find(".ckb-shipping-status-shipped").prop("checked",!1),e.find(".ckb-shipping-status-arrived").prop("checked",!1)),$.ajax({url:"/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"forward":"notshipped"}}).done(function(){t.checked?e.addClass("off-middle"):e.removeClass("off").removeClass("off-middle")})}),$(".ckb-shipping-status-arrived").click(function(){var t=this,e=$(this).parents("tr");this.checked?(e.find(".ckb-shipping-status-shipped").prop("checked",!0),e.find(".ckb-shipping-status-forward").prop("checked",!0)):(e.find(".ckb-shipping-status-shipped").prop("checked",!1),e.find(".ckb-shipping-status-forward").prop("checked",!1)),$.ajax({url:"/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"arrived":"notshipped"}}).done(function(){t.checked?e.addClass("off"):e.removeClass("off").removeClass("off-middle")})}),$("#select-site-type").change(function(){return this.value?location.href="/purchase?site-type="+this.value:void(location.href="/purchase")}),$(".ckb-shipping-status").click(function(){this.checked?location.href="/purchase?shipping-status="+this.name+"&site-type="+$("#site-type").val():location.href="/purchase?site-type="+$("#site-type").val()}),$(".import-order").click(function(){$.ajax({url:"/purchase/import-order",type:"post",data:{purchaseId:$(this).data("purchase-id"),status:this.checked}}).done(function(){console.log(333)})});var t=$("#table"),e=$(".hide-wisdom-luckymojo-list");$.cookie("hide-wisdom-luckymojo-list")&&(e.prop("checked",!0),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).addClass("hide")})),e.click(function(){this.checked?($.cookie("hide-wisdom-luckymojo-list","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).addClass("hide")})):($.cookie("hide-wisdom-luckymojo-list","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),t.find("tbody tr").each(function(t,e){($(e).text().indexOf("luckymojo")>-1||$(e).text().indexOf("wisdom")>-1)&&$(e).removeClass("hide")}))})},addFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead()},editFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead(),this.purchaseProductTableList()},purchaseTypeAhead:function(){var t=$("#purchase-description"),e=$("#purchase-website"),n=$("#purchase-mail"),i=$("#purchase-image"),a=$(".purchase-image"),o=$("#purchase-comment"),c=function(){return/site-type=/.test(location.search)?/site-type=(.+)$/.exec(location.search)[1]:"normal"}();t.typeahead(null,{display:"value",highlight:!0,source:new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),queryTokenizer:r.tokenizers.whitespace,remote:{url:"/purchase/add/website-desc",prepare:function(e,n){return n.data={name:t.val(),"site-type":c},n}}})}),t.on({"typeahead:select":function(t,r){console.info(r),e.val(r.website?r.website:r.shop),n.val(r.email),i.val(r.image),a.find("img").attr("src",r.image),o.val(r.comment)}})},purchaseProductTableList:function(){var t=$("#purchase-order-link"),e=$(".purchase-order-link-view"),n=$.trim($("#purchase-order-link").val()),r="",a="";return n?($.each(n.split("\n"),function(t,e){""!==$.trim(e)&&(e=e.replace(/\*\s/,"*"),e=e.replace(/(\S)\*/,"$1 *"),/\*\d*/.test(e)||(e+=" *1"),r+=e+(t===n.split("\n").length-1?"":"\n"))}),t.val(r),$.each(r.split("\n"),function(t,e){var n="-",r="-",o=function(){return/http[^\s]+/i.test(e)?/(http[^\s]+)/i.exec(e)[1]:/(.*)\*\d+/.exec(e)[1]}(),c=function(){return/\*\d+/.test(e)?/\*(\d+)/.exec(e)[1]:1}(),s=function(){return/\|\d+/.test(e)?"-"+/\|(\d+)/.exec(e)[1]:""}();/\.(jpg|jpeg|png|gif)/.test(o)?(n='<a href="'+o+'" target="_blank"><img src="'+o+'" /></a>',o='<span title="'+o+'"><a href="'+o+'" target="_blank">'+o+"</a></span>"):/^http/.test(o)?(i.getRemoteProductInfo(o,function(e,n){e.length&&($(".link-product-"+t).find(".img").html('<a href="'+e+'" target="_blank"><img src="'+e+'" /></a>'),$(".link-product-"+t).find(".title").text(""+n))}),o='<span title="'+o+'"><a href="'+o+'" target="_blank">'+o+"</a></span>"):o='<span title="'+o+'">'+o+"</span>";var u='\n                    <tr class="link-product-'+t+'">\n                        <td class="img t-c">'+n+'</td>     \n                        <td class="count t-c">'+c+' <span class="count-result">'+s+'</span></a></td>      \n                        <td class="count t-c">\n                            <a href="javascript:;" class="count-minus">预定+1</a>\n                            <span class="sp"></span>\n                            <a href="javascript:;" class="count-plus">取消-1</a>\n                        </td>      \n                        <td class="link">'+o+'</td>    \n                        <td class="title">'+r+"</td>      \n                    </tr>\n                ";a+=u}),e.find("tbody").append(a),e.find(".link a").click(function(){e.find(".on").removeClass("on"),$(this).parents("td").addClass("on")}),e.find(".count-minus").click(function(){var e=t.val(),n="",r=$(this).parents("tr"),i=r.find(".link span").attr("title"),a=r.find(".count-result"),o=e.split("\n");$.each(o,function(t,e){if(e.indexOf(i)>-1){var r=parseInt(/\*(\d+)/.exec(e)[1]),o=function(){return/\|\d+/.test(e)?parseInt(/\|(\d+)/.exec(e)[1]):0}();r>o&&(o++,a.text("-"+o)),e=/\|\d+/.test(e)?e.replace(/\|\d+/,"|"+o):e.replace(/(\*\d+)/,"$1 |"+o)}n+=e+"\n"}),t.val($.trim(n))}),void e.find(".count-plus").click(function(){var e=t.val(),n="",r=$(this).parents("tr"),i=r.find(".link span").attr("title"),a=r.find(".count-result"),o=e.split("\n");$.each(o,function(t,e){if(e.indexOf(i)>-1){var r=function(){return/\|\d+/.test(e)?parseInt(/\|(\d+)/.exec(e)[1]):0}();r>1?(r--,a.text("-"+r)):1===r&&(r--,a.text("")),e=/\|\d+/.test(e)?e.replace(/\|\d+/,"|"+r):e.replace(/(\*\d+)/,"$1 |"+r),e=e.replace(/\s\|0/,"")}n+=e+"\n"}),t.val($.trim(n))})):!1}}},{"../common/utils":6,bloodhound:10,"jquery-validate":19}],"product-method":[function(t,e,n){"use strict";window.leanAppHeader;e.exports={indexFun:function(){var t=$(".remove-product-method"),e=$("#confirm-remove-product-method"),n=$("#modal-alert");n.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.click(function(){e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget),r=parseInt(t.data("id"));return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.ajax({type:"post",url:"/product-method/remove/"+r,success:function(r){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),r.success?n.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除产品类型成功!"):n.modal().find(".am-modal-bd").text(r.message)}}),!1)}})})},addFun:function(){this.submitControl()},editFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{}],"product-category":[function(t,e,n){"use strict";e.exports={indexFun:function(){this.container=$(".am-accordion"),this.selectProductMethod(),this.addCategory1(),this.editCategory1(),this.removeCategory1(),this.moveCategory1Up(),this.moveCategory1Down(),this.addCategory2(),this.editCategory2(),this.removeCategory2(),this.moveCategory2Up(),this.moveCategory2Down()},selectProductMethod:function(){var t=$(".select-product-method");this.productMethodId=t.val()?parseInt(t.val()):0,t.change(function(){location.href="/product-category?product-method-id="+this.value})},addCategory1:function(){var t=$("#modal-category-1-add"),e=$("#input-category-1-add"),n=$("#modal-category-1-confirm-add"),r=this.productMethodId;$(".btn-category-1-add").click(function(){e.val(""),t.modal({relatedTarget:this})}),n.click(function(){return n.data("state")?!1:($.AMUI.progress.start(),n.data("state",!0),$.post({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:JSON.stringify({index:$(".am-accordion-item").length,name:$.trim(e.val())?$.trim(e.val()):"无分类名",productMethodId:r}),success:function(){$.AMUI.progress.done(),n.data("state",!1),t.modal("close"),location.reload()}}),!1)})},editCategory1:function(){var t=$("#modal-category-1-edit"),e=$("#input-category-1-edit"),n=$("#modal-category-1-confirm-edit"),r=$("#modal-alert"),i=this.productMethodId,a=null;$(".edit-category-1").each(function(){$(this).click(function(){var n=$(this).parents(".am-accordion-title").find("strong").text();return e.val($.trim(n)),t.modal({relatedTarget:this}),a=$(this).parents(".am-accordion-item").attr("data-id"),!1})}),n.click(function(){return n.data("state")?!1:($.AMUI.progress.start(),n.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:'where={"category1Id":'+a+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory1/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val()),productMethodId:i})})}).done(function(){n.data("state",!1),$.AMUI.progress.done(),t.modal("close"),r.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("编辑一级分类成功!")}),!1)})},removeCategory1:function(){var t=$(".remove-category-1"),e=$("#modal-category-1-remove"),n=$("#modal-alert");n.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.each(function(t,r){$(r).click(function(){$(this);return e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget);return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/remove-category-1",data:{id:t.parents(".am-accordion-item").attr("data-id")},success:function(r){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),r.success?n.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除一级分类成功!"):n.modal().find(".am-modal-bd").text(r.message)}}),!1)}}),!1})})},moveCategory1Up:function(){$(".moveup-category-1").each(function(){$(this).click(function(){var t=$(this),e=t.parents(".am-accordion-item"),n=e.prev(),r=e.attr("data-id"),i=n.attr("data-id"),a=e.index();return 0===a?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-1-up",data:{currentId:r,targetId:i}}).done(function(r){r.success&&(e.after(n),t.data("state",!1),$.AMUI.progress.done())}),!1)})})},moveCategory1Down:function(){var t=$(".am-accordion-item");$(".movedown-category-1").each(function(){$(this).click(function(){var e=$(this),n=e.parents(".am-accordion-item"),r=n.next(),i=n.attr("data-id"),a=r.attr("data-id"),o=n.index();return o===t.length-1?!1:e.data("state")?!1:(e.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-1-down",data:{currentId:i,targetId:a}}).done(function(t){t.success&&(n.before(r),e.data("state",!1),$.AMUI.progress.done())}),!1)})})},addCategory2:function(){var t=$("#modal-category-2-add"),e=$("#input-category-2-add"),n=$("#modal-category-2-confirm-add"),r=null,i=null;$(".btn-category-2-add").each(function(n,a){$(a).click(function(){r=$(this).parents(".am-accordion-item"),i=parseInt(r.attr("data-id")),e.val(""),t.modal({relatedTarget:this})})}),n.click(function(){if(n.data("state"))return!1;$.AMUI.progress.start(),n.data("state",!0);var a=r.find(".category-2-list li").length;return $.post({url:"/product-category/add-category-2",data:{index:a,name:$.trim(e.val())?$.trim(e.val()):"无标题",category1Id:i}}).done(function(e){$.AMUI.progress.done(),n.data("state",!1),t.modal("close");var i=$(".select-product-method").val(),a=r.data("id");r.find(".category-2-list").append('\n                        <li data-id="'+e.id+'">\n                            <strong>\n                                <a href="/product-record?product-method-id='+i+"&category1-id="+a+"&category2-id="+e.id+'" target="_blank">'+e.name+'</a>\n                            </strong>\n                             <a href="/product-record/add?product-method-id='+i+"&category1-id="+a+"&category2-id="+e.id+'" target="_blank">[新建]</a>\n                            <span class="options">\n                                <a class="edit-category-2" href="javascript:;">编辑</a>\n                                <a class="moveup-category-2" href="javascript:;">上移</a>\n                                <a class="movedown-category-2" href="javascript:;">下移</a>\n                                <a class="remove-category-2" href="javascript:;">删除</a>\n                            </span>\n                        </li>\n                ')}),!1})},editCategory2:function(){var t=$("#modal-category-2-edit"),e=$("#input-category-2-edit"),n=$("#modal-category-2-confirm-edit"),r=$("#modal-alert"),i=null,a=null;this.container.on("click",".edit-category-2",function(){return i=$(this).parents("li"),e.val($.trim(i.find("strong").text())),a=i.attr("data-id"),t.modal({relatedTarget:this}),!1}),n.click(function(){return n.data("state")?!1:($.AMUI.progress.start(),n.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory2",headers:leanAppHeader,data:'where={"category2Id":'+a+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory2/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val())})})}).done(function(){n.data("state",!1),$.AMUI.progress.done(),t.modal("close"),r.modal({onConfirm:function(){return i.find("strong a").text(e.val())}}).find(".am-modal-bd").text("编辑二级分类成功!")}),!1)})},removeCategory2:function(){var t=$("#modal-category-2-remove"),e=$("#modal-alert");e.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),this.container.on("click",".remove-category-2",function(){return t.modal({relatedTarget:this,onConfirm:function(){var n=$(this.relatedTarget),r=n.parents("li");return n.data("state")?!1:(n.data("state",!0),
$.AMUI.progress.start(),$.get({url:"/product-category/remove-category-2",data:{category1Id:r.parents(".am-accordion-item").attr("data-id"),category2Id:r.attr("data-id")},success:function(i){n.data("state",!1),$.AMUI.progress.done(),t.modal("close"),i.success?e.modal({onConfirm:function(){return r.detach()}}).find(".am-modal-bd").text("删除二级分类成功!"):e.modal().find(".am-modal-bd").text(i.message)}}),!1)}}),!1})},moveCategory2Up:function(){this.container.on("click",".moveup-category-2",function(){var t=$(this),e=$(this).parents("li"),n=e.attr("data-id"),r=e.prev(),i=r.attr("data-id"),a=e.index();return 0===a?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-2-up",data:{currentId:n,targetId:i}}).done(function(n){n.success&&(e.after(r),t.data("state",!1),$.AMUI.progress.done())}),!1)})},moveCategory2Down:function(){this.container.on("click",".movedown-category-2",function(){var t=$(this),e=$(this).parents("li"),n=e.attr("data-id"),r=e.next(),i=r.attr("data-id"),a=e.index();return a===e.parent().find("li").length-1?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-2-down",data:{currentId:n,targetId:i}}).done(function(n){n.success&&(e.before(r),t.data("state",!1),$.AMUI.progress.done())}),!1)})}}},{}],"product-brand":[function(t,e,n){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".remove-product-brand").click(function(){var t=$(this);return $("#confirm-remove-product-brand").modal({relatedTarget:this,onConfirm:function(){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-product-brand").validate(),this.setTabs()},editFun:function(){$("#form-edit-product-brand").validate(),this.setTabs()},setTabs:function(){$(".am-tabs").tabs({animation:!1})}}},{"jquery-validate":19}],"product-book":[function(t,e,n){"use strict";t("jquery-validate");var r=t("bloodhound");e.exports={indexFun:function(){$(".remove-product-book").click(function(){var t=$(this);return $("#confirm-remove-product-book").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-search-state").click(function(){this.checked?location.href="/product-book?search-state=on":location.href="/product-book"}),$(".set-product-state").click(function(){var t=this,e=[];$(this).parents("tr").find(".set-product-state").each(function(){this.checked?e.push("on"):e.push("")}),$.ajax({type:"post",url:"/product-book/set-product-state",data:{"product-book-id":$(this).data("product-book-id"),"product-state":JSON.stringify(e)}}).done(function(e){e.success&&(t.checked?$(t).parent().find("i").addClass("strong"):$(t).parent().find("i").removeClass("strong"))})})},addFun:function(){$("#form-add-product-book").validate(),this.productEdit(),this.customerTypeAhead(),this.productTypeAhead(),$(".product-name").get(1).focus()},editFun:function(){$("#form-edit-product-book").validate(),this.productEdit(),this.customerTypeAhead(),this.productTypeAhead()},productEdit:function(){var t=this,e=$(".product-list"),n=(e.find(".am-form-group").eq(0),'\n            <div class="am-form-group typeahead-content">\n                        <div class="am-u-sm-7">\n                            <input class="product-name" required name="product-name" autocomplete="off" type="text" placeholder="输入产品名">\n                        </div>\n                        <div class="am-u-sm-2">\n                            <input class="product-image" name="product-image" type="text" placeholder="输入图片链接">\n                        </div>\n                        <div class="am-u-sm-1">\n                            <select class="product-count" name="product-count">\n                                <option value="1">1</option>\n                                <option value="2">2</option>\n                                <option value="3">3</option>\n                                <option value="4">4</option>\n                                <option value="5">5</option>\n                            </select>\n                        </div>\n                        <div class="am-u-sm-1 am-form-label t-c">\n                            <label><input type="checkbox" class="ckb-product-state"> <span class="small-screen-hide">已发货</span></label>\n                            <input type="hidden" name="product-state" class="product-state"/>\n                        </div>\n                        <div class="am-u-sm-1 am-form-label"><a href="javascript:;" class="remove">删除</a></div>\n                    </div>\n        ');$(".product-add").click(function(){var r=$(n);e.append(r),t.bindProductTypeAhead(r.find(".product-name")),r.find(".product-name").get(1).focus()}),e.on("click",".remove",function(){$(this).parents(".am-form-group").detach()}),$(".ckb-product-state").change(function(){var t=$(this).parents(".am-form-group");this.checked?t.find(".product-state").val("on"):t.find(".product-state").val("")})},customerTypeAhead:function(){var t=$("#customer-name"),e=$("#customer-id"),n=$(".customer-info");t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><span class="tt-value">'+t.value+'</span><span class="tt-footer">'+t.address+" "+(t.taobao?"淘宝名:"+t.taobao+" ":" ")+(t.weixin?"微信号:"+t.weixin:"")+"</span></div>"}},highlight:!0,source:new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),queryTokenizer:r.tokenizers.whitespace,remote:{url:"/product-book/get-customer-name",prepare:function(e,n){return n.data={name:t.val()},n}}})}),t.on({"typeahead:select":function(t,r){e.val(r.customerId).focus(),n.html('用户信息: 姓名:<a href="/customer/edit/'+r.customerId+'">'+r.value+"</a> | 淘宝号:"+r.taobao+" | 微信号:"+r.weixin+" | 地址:"+r.address)}})},productTypeAhead:function(){var t=this;$(".product-name").each(function(e,n){t.bindProductTypeAhead($(n))})},bindProductTypeAhead:function(t){t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><img src="'+t.image+'?imageMogr2/thumbnail/32" />'+t.value+" </div>"}},highlight:!0,source:new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),queryTokenizer:r.tokenizers.whitespace,remote:{url:"/order/product",prepare:function(e,n){return n.data={name:t.val()},n}}})}),t.on({"typeahead:select":function(e,n){t.parents(".am-form-group").find(".product-image").val(n.image)}})}}},{bloodhound:10,"jquery-validate":19}],product:[function(t,e,n){"use strict";t("jquery-validate");var r=t("./lib/product-preview");e.exports={indexFun:function(){$(".select-category").change(function(){this.value>0&&(location.href="/product?categoryId="+this.value)}),$(".remove-product").click(function(){var t=$(this);return $("#confirm-remove-product").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-product").validate(),this.chooseBanner(),this.formActionSelect(),this.setTabs(),this.setMainImage()},editFun:function(){$("#form-add-product").validate(),this.chooseBanner(),this.formActionSelect(),this.setTabs(),this.setMainImage()},previewFun:r,chooseInfo:function(){var t=$("#content-info"),e=$("#md-code-info");e.val("![]("+t.find(".product-title img").attr("src")+")"),t.find(":checkbox").click(function(){this.checked?e.val("![]("+t.find(".product-title img").attr("src")+")"):e.val("")})},chooseBanner:function(){var t,e,n=$("#select-banner"),r=n.find("option").length-1,i=$(".code-banner"),a=$("#md-code-banner");if(0===parseInt(n.val())){var o=Math.floor(Math.random(100)*r);t=n.find("option:eq("+o+")").attr("data-src"),e=n.find("option:eq("+o+")").text(),i.html('<img src="'+t+'"/>'),a.val("!["+e+"]("+t+")")}else t=n.find("option:selected").attr("data-src"),e=n.find("option:selected").text(),i.html('<img src="'+t+'"/>'),a.val("!["+e+"]("+t+")");n.on("change",function(){if(0===parseInt(this.value)){var o=Math.floor(Math.random(100)*r);t=n.find("option:eq("+o+")").attr("data-src"),e=n.find("option:eq("+o+")").text()}else t=n.find("option[value="+this.value+"]").attr("data-src"),e=n.find("option[value="+this.value+"]").text();i.html('<img src="'+t+'"/>'),a.val("!["+e+"]("+t+")")}),$(".banner-enable").click(function(){this.checked?(a.val(""),n.addClass("hide"),i.addClass("hide"),a.addClass("hide")):(n.trigger("change"),n.removeClass("hide"),i.removeClass("hide"),a.removeClass("hide"))})},formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})},setTabs:function(){$(".am-tabs").tabs({animation:!1})},setMainImage:function(){var t=$("#content-main-image").find("ul"),e=$("#main-image");e.change(function(){t.empty();var n=e.val().split("\n");""!==$.trim(n[0])&&$.each(n,function(e,r){t.append('<li><a href="'+n[e]+'" target="_blank"><img src="'+n[e]+'"/></a></li>')})}).trigger("change")}}},{"./lib/product-preview":7,"jquery-validate":19}],order:[function(t,e,n){"use strict";t("jquery-validate");var r=t("bloodhound"),i=t("../common/utils");e.exports={indexFun:function(){function t(t){var e=$("#modal-set-stock"),n=parseInt(t.attr("product-count"));setTimeout(function(){for(var t=0;n>t;t++)e.find(".stock-minus").click()},1e3),setTimeout(function(){e.find(".stock-save").click()},1500)}function e(){location.href=i.urlParamsComponent("/order",{limit:$("#limit").val(),"search-not-shipped":$("#search-not-shipped").val(),"search-shipping":$("#search-shipping").val()})}var n=!1,r=$(".btn-one-update-stock"),a=$("#modal-update-stock-confirm"),o=$("#modal-update-alert");r.each(function(t,e){$(e).click(function(){var t=$(this).parents("tr"),e=t.find(".set-stock"),r=$(this),i=1,c="",s="";t.find(".order-split").filter(function(){return!$(this).hasClass("is-parent-product")}).filter(function(){return $(this).find(".set-stock")[0]?!0:!1}).each(function(t,e){var n=$(e).data("count"),r=$(e).data("stock");if(n==r)c="<strong>发现存在库存数即将无库存的产品：</strong>",s+='<div class="stock-list">'+($(e).find(".image").html()+" "+$(e).find(".product-title").html())+"</div>",i=2;else if(n>r)return c="<strong>无法执行，请手动操作！<br/>发现发货数小于库存数的产品：</strong>",s='<div class="stock-list">'+($(e).find(".image").html()+" "+$(e).find(".product-title").html())+"</div>",i=3,!1}),1===i?(r.attr("disabled",!0),r.find("span").text("更新中，请勿操作"),n=!0,setTimeout(function(){e.eq(0).click()},1500)):2===i?(a.modal({relatedTarget:this,onConfirm:function(t){r.attr("disabled",!0),r.find("span").text("更新中，请勿操作"),n=!0,setTimeout(function(){e.eq(0).click()},1500)}}),a.find(".am-modal-hd").html(c),a.find(".am-modal-bd").html(s)):3===i&&(o.modal(),o.find(".am-modal-hd").html(c),o.find(".am-modal-bd").html(s))})}),$(".remove-order").click(function(){var t=$(this);return $("#confirm-remove-order").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1});var c={customerId:[],orderId:[]},s=$(".am-table").find("tr[data-customer-id]");s.each(function(t,e){$(e).data("customer-id")&&(c.customerId.push($(e).data("customer-id")),c.orderId.push($(e).data("order-id")))}),$.ajax({url:"/order/get-customer",data:{queryData:c}}).then(function(t){t.success&&$.each(s,function(e,n){var r=parseInt($(n).data("customer-id"));$.each(t.shippings,function(t,e){e.customerId===r&&$(n).find(".customer-name").addClass("shunfeng")})})});var u=[],d=$(".image");d.each(function(t,e){$(e).data("id")&&u.push($(e).data("id"))}),$.ajax({url:"/order/get-image",data:{productId:u.join()}}).then(function(t){t.success&&$.each(d,function(e,n){var r=parseInt($(n).data("id"));if($.isEmptyObject(t.images))$(n).removeClass("on").html('<img width="60" src="'+window.assets["no-image-src"]+'?imageMogr2/thumbnail/60"/>');else for(var i in t.images)parseInt(i)===r?$(n).removeClass("on").html('<a href="'+t.images[i]+'" target="_blank"><img width="60" src="'+t.images[i]+'?imageMogr2/thumbnail/60"/></a>'):r||$(n).removeClass("on").html('<img width="60" src="'+window.assets["no-image-src"]+'?imageMogr2/thumbnail/60"/>')})}),$(".product-order-list").on("click",".update-stock",function(){var t=$(this);if(t.data("state"))return!1;t.data("state",!0);var e=t.find(".am-icon").hasClass("on"),n=t.attr("product-id"),r=t.attr("order-id");$.ajax({url:"/order/update-stock",data:{"is-set":e,"product-id":n,"order-id":r},success:function(n){t.data("state",!1),n.success&&(e?t.find(".am-icon").removeClass("on").addClass("off"):t.find(".am-icon").removeClass("off").addClass("on"))}})});var l=$("#modal-set-stock"),p=l.find("input[name=stock]"),f=l.find("[name=sales]"),h=l.find(".stock-minus"),m=l.find(".stock-plus"),v=$(".stock-save"),g=$(".stock-reset"),y=$(".ckb-warning-stock-out"),k=$(".ckb-warning-stock-in"),b=0,x=l.find(".product-info");$(".product-order-list").on("click",".set-stock",function(){return l.modal({relatedTarget:this,onCancel:function(){return!1}}),!1}),l.on("open.modal.amui",function(e){var r=$(e.relatedTarget);r.addClass("current");var i=r.attr("product-id");v.attr("product-id",i),y.prop("checked",!1),k.prop("checked",!1),x.html(r.parent().find(".image").html()+" "+r.parent().find(".product-title").text()),$.ajax({type:"get",url:"/order/set-stock",data:{"product-id":i},success:function(e){return e.success?(p.val(e.stock),b=e.stock,p.attr("data-stock",e.stock),f.val(e.sales),f.attr("data-sales",e.sales),v.attr("product-id",i),e.updateStockDate>1?k.prop("checked",!0):0==e.updateStockDate&&y.prop("checked",!0),m.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary"),h.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary"),setTimeout(function(){p[0].focus(),p[0].select()},100),void(n&&t(r))):!1}})}),l.on("close.modal.amui",function(){if(p.val(0),p.attr("data-stock",0),f.val(0),f.attr("data-sales",0),v.removeAttr("product-id"),m.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary"),h.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary"),x.html(""),n){var t=$(".set-stock.current"),e=t.parents(".order-split").next(),r=t.parents(".product-order-list"),i=r.find(".btn-one-update-stock");if(e.hasClass("order-split")){var a=void 0;a=e.hasClass("is-parent-product")?e.next().find(".set-stock"):e.find(".set-stock"),setTimeout(function(){a.click()},2e3)}else n=!1,i.attr("disabled",!1),i.find("span").text("一键更新库存"),setTimeout(function(){var e=t.parents("tr").find(".ckb-shipped");e.prop("checked")||(e.click(),i.attr("disabled",!0))},2e3)}$(".set-stock.current").removeClass("current")}),h.click(function(){var t=parseInt(p.val()),e=parseInt(f.val());t>0&&(p.val(t-1),f.val(e+1)),p.trigger("change")}),m.click(function(){var t=parseInt(p.val());p.val(t+1),p.trigger("change")}),v.click(function(){var t,e=$(this);$("input[name='updateStockDate']:checked").each(function(){t=$(this).val()}),$.ajax({type:"post",url:"/order/set-stock",data:{"product-id":e.attr("product-id"),stock:p.val(),sales:f.val(),updateStockDate:t},success:function(t){if(t.success){var e=$(".set-stock.current").parents(".order-split").find(".update-stock");e.find(".am-icon").hasClass("off")&&e.trigger("click"),l.modal("close")}}})}),g.click(function(){p.find("option[value="+p.attr("stock")+"]")[0].selected=!0,f.val(f.attr("sales")),p.trigger("change")}),y.click(function(){k.prop("checked",!1)}),k.click(function(){y.prop("checked",!1)}),p.change(function(){var t=parseInt(p.val());t>0&&0==b?(k.prop("checked",!0),y.prop("checked",!1)):0==t?(y.prop("checked",!0),k.prop("checked",!1)):(k.prop("checked",!1),y.prop("checked",!1))}),$(".ckb-not-shipped").click(function(){$("#search-not-shipped").val(this.checked?"on":""),e()}),$(".select-shipping").change(function(){$("#search-shipping").val(this.value?this.value:""),e()}),$(".select-limit").change(function(){$("#limit").val(this.value?this.value:""),e()}),$(".ckb-shipped").click(function(){var t=$(this),e=$(this).attr("order-id"),n=this.checked;$.ajax({type:"post",url:"/order/shipping",data:{"order-id":e,shipping:n},success:function(e){e.success&&(t[0].checked?(t.parents("tr").removeClass("off"),setTimeout(function(){location.reload()},500)):t.parents("tr").addClass("off"))}})});var w=$(".action-shipping-company");w.popover({content:'<input class="shipping-company-input"/>'});var C=$(".shipping-company-input");w.each(function(t){$(this).on("open.popover.amui",function(){setTimeout(function(){return C.get(t).focus()},0)})}),C.each(function(t){var e=w.eq(t),n=e.data("order-id");$(this).change(function(){$.ajax({url:"/order/action-tracking-number",data:{orderId:n,trackingNumber:$(this).val()}}).then(function(t){if(t.success){e.removeClass("disabled"),e.off().attr("href","http://www.kuaidi100.com/auto.shtml?nu="+t.trackingNumber),e.popover("close");var n=e.parent().find(".clipboard-tracking-number"),r=new Clipboard(n[0],{text:function(){return t.trackingNumber}});r.on("success",function(){n.addClass("active")})}})})}),$(".clipboard-tracking-number").each(function(){var t=this;if($(this).attr("data-clipboard-text")){var e=new Clipboard(this);e.on("success",function(){$(t).addClass("active")})}}),$(".clipboard-customer-name").each(function(){var t=this,e=new Clipboard(this);e.on("success",function(){$(t).addClass("am-btn-success")})}),$(".clipboard-customer-address").each(function(){var t=this,e=new Clipboard(this);e.on("success",function(){$(t).addClass("active")})});var T=$("#modal-track-order"),j=T.find(".am-modal-hd"),I=T.find(".am-modal-bd");$(".track-order").click(function(){return j.find("span").text($(this).data("track")),I.html("<ul></ul>"),$.ajax($(this).attr("href")).then(function(t){if(t.list){var e="";$.each(t.list,function(t,n){e+='<li class="'+(0===t?"success":"")+'">'+n.status+" "+n.time+"</li>"}),I.find("ul").append(e)}else I.find("ul").append("<li>暂无发货记录,请稍后查看</li>");T.modal()}),!1});var A=$(".ckb-show-main-shop-order"),q=$(".ckb-show-new-shop-order");$.cookie("show-main-shop-order")&&(A.prop("checked",!0),$(".new-shop-order").addClass("hide")),A.click(function(){this.checked?($.cookie("show-main-shop-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".new-shop-order").addClass("hide"),q.prop("checked")&&q.click()):($.cookie("show-main-shop-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".new-shop-order").removeClass("hide"))});var S=$(".ckb-show-main-shop-order"),F=$(".ckb-show-new-shop-order");$.cookie("show-new-shop-order")&&(F.prop("checked",!0),$(".main-shop-order").addClass("hide")),F.click(function(){this.checked?($.cookie("show-new-shop-order","true",{expires:new Date((new Date).getTime()+31536e6),path:"/",domain:location.host}),$(".main-shop-order").addClass("hide"),S.prop("checked")&&S.click()):($.cookie("show-new-shop-order","",{expires:new Date((new Date).getTime()),path:"/",domain:location.host}),$(".main-shop-order").removeClass("hide"))});var z=$(".show-not-ship-count"),O=(new Date).getTime(),_=new Date(O-2592e5),U=new Date(O-864e5),M=U.getFullYear()+"-"+(U.getMonth()+1)+"-"+U.getDate(),D=_.getFullYear()+"-"+(_.getMonth()+1)+"-"+_.getDate();$.ajax({url:"/order/get-shipping-status-count?preDate="+M,success:function(t){0===t.mainShopCount&&z.find(".main-shop-day-1").addClass("on"),0===t.subShopCount&&z.find(".sub-shop-day-1").addClass("on"),z.find(".main-shop-day-1").text(t.mainShopCount),z.find(".sub-shop-day-1").text(t.subShopCount)}}),$.ajax({url:"/order/get-shipping-status-count?preDate="+D,success:function(t){0===t.mainShopCount&&z.find(".main-shop-day-3").addClass("on"),0===t.subShopCount&&z.find(".sub-shop-day-3").addClass("on"),z.find(".main-shop-day-3").text(t.mainShopCount),z.find(".sub-shop-day-3").text(t.subShopCount)}}),$(".product-order-list").each(function(){var t=$(this),e=t.find(".btn-one-update-stock"),n=!1,r=$(this),i=r.find(".product-number"),a=0;r.find(".product-count").each(function(t,e){a+=parseInt($(e).text())}),r.find(".order-split").each(function(r,o){var c=$(o).data("id"),s=parseInt($(o).find(".product-count").text());a>1&&i.html('<strong class="font-red">[共'+a+"件]</strong>"),$.ajax({type:"get",url:"/order/get-stock",data:{"product-id":c},success:function(r){$(o).attr("data-stock",r.stock);var i=$(o).find(".product-title"),a=i.html(),c="";r.comment&&(c=' <span style="color:#333">[注:'+r.comment.trim()+"]</span>"),a+=" {库:"+r.stock+"}"+c,i.html(a);var u=parseInt($(o).find(".product-count").text());u>r.stock&&$(o).find(".product-title").addClass("out-stock"),r.bindingId&&(n=!0,$(o).addClass("is-parent-product"),$(o).find(".update-stock").detach(),$(o).find(".set-stock").detach(),$.ajax({type:"get",url:"/order/get-binding-product",data:{"product-id":r.bindingId},success:function(n){var i=[];for(var a in n.mainImage)i.push(n.mainImage[a].url);var c="";r.bindingNumber*s>n.stock&&(c="out-stock");var u="off";t.find(".ckb-shipped").prop("checked")&&(u="on"),$(o).after('\n                                    \n                                    <div class="order-split child" data-id="'+r.bindingId+'" data-stock="'+n.stock+'" data-count="'+r.bindingNumber*s+'">\n                                    \n                                        <span class="image loading-elem" data-id="'+r.bindingId+'"><a href="'+i[0]+'" target="_blank"><img width="48" src="'+i[0]+'"></a></span>\n\n                                        <a class="product-title '+c+'" href="/order/edit/'+$(o).parents("tr").data("order-id")+'"><span class="product-count"><strong class="font-red product-count">'+r.bindingNumber*s+"</strong></span>*"+n.name+" {id:"+r.bindingId+"} {库:"+n.stock+'}</a>\n \n                                        <a class="set-stock" product-count="'+r.bindingNumber*s+'" product-id="'+r.bindingId+'" title="设置库存" href="javascript:;"><i class="am-icon am-icon-inbox"></i></a>\n                                        <a class="update-stock" order-id="'+$(o).parents("tr").data("order-id")+'" product-id="'+r.bindingId+'" title="是否已设置库存" href="javascript:;"><i class="am-icon am-icon-check-circle '+u+'"></i></a>\n                        \n                    </div>\n                                    \n                                    '),e.prop("disabled")&&!t.find(".ckb-shipped").prop("checked")&&e.removeAttr("disabled")}})),e.prop("disabled")&&!t.find(".ckb-shipped").prop("checked")&&n===!1&&e.removeAttr("disabled")}})})}),$(".clipboard-customer-address").each(function(t,e){var n=$(e).attr("title"),r="";/[^\，]+/.test(n)&&(r+=/([^\，]+)/.exec(n)[1]),/[\u4E00-\u9FA5]+省/.test(n)&&(r+=" , "+/([\u4E00-\u9FA5]+省)/.exec(n)[1]),/[\u4E00-\u9FA5]+自治区/.test(n)&&(r+=" , "+/([\u4E00-\u9FA5]+自治区)/.exec(n)[1]),/[\u4E00-\u9FA5]+市/.test(n)&&(r+=" "+/([\u4E00-\u9FA5]+市)/.exec(n)[1]),$(e).prev().html(r)})},addFun:function(){$("#form-add-order").validate({submitHandler:function(t){$("#shipping-address").val().indexOf("新疆")>0&&alert("收货地址含有新疆省！"),$("#shipping-address").val().indexOf("西藏")>0&&alert("收货地址含有西藏省！"),t.submit()}}),this.customerNameTypeAhead(),this.orderTypeAheadAdd(),this.domUpdate(),this.orderBatchAdd(),-1!==location.search.indexOf("name")?(this.copyNewOrder(),this.orderNameTypeAhead()):(this.orderNameTypeAhead(),$("input[name]").get(0).focus()),location.search.indexOf("is-new-shop")>-1&&$(".is-new-shop").prop("checked",!0)},copyNewOrder:function(){var t=location.search,e=/name=([^\&]*)\&/.exec(t)[1],n=/tracking-number=(\d+)/.test(t);e=e.split(","),$("input[name=name]").eq(0).val(decodeURIComponent(e[0])),n&&$("#tracking-number").val(/tracking-number=(\d+)/.exec(t)[1])},editFun:function(){$("#form-edit-order").validate({submitHandler:function(t){$("#shipping-address").val().indexOf("新疆")>0&&alert("收货地址含有新疆省！"),$("#shipping-address").val().indexOf("西藏")>0&&alert("收货地址含有西藏省！"),t.submit()}}),this.customerNameTypeAhead(),this.orderTypeAheadUpdate(),this.domUpdate(),this.orderNameTypeAhead(),this.orderBatchAdd(),this.clipboard()},domUpdate:function(){var t=this,e=($("#shipping-company"),$("#tracking-number"),$(".content-name-group")),n='\n                    <div class="list-group-field am-form-group">\n                        <div class="am-u-sm-8">\n                            <input class="name" name="name" type="text" placeholder="输入订单内容" autocomplete="off">\n                        </div>\n                        <div class="am-u-sm-1">\n                            <select name="shipping-count">\n                                <option value="1">1</option>\n                                <option value="2">2</option>\n                                <option value="3">3</option>\n                                <option value="4">4</option>\n                                <option value="5">5</option>\n                                <option value="6">6</option>\n                                <option value="7">7</option>\n                                <option value="8">8</option>\n                                <option value="9">9</option>\n                                <option value="10">10</option>\n                                <option value="11">11</option>\n                                <option value="12">12</option>\n                                <option value="13">13</option>\n                                <option value="14">14</option>\n                                <option value="15">15</option>\n                                <option value="16">16</option>\n                                <option value="17">17</option>\n                                <option value="18">18</option>\n                                <option value="19">19</option>\n                                <option value="20">20</option>\n                                <option value="21">21</option>\n                                <option value="22">22</option>\n                                <option value="23">23</option>\n                                <option value="24">24</option>\n                                <option value="25">25</option>\n                                <option value="26">26</option>\n                                <option value="27">27</option>\n                                <option value="28">28</option>\n                                <option value="29">29</option>\n                                <option value="30">30</option>\n                                <option value="31">31</option>\n                                <option value="32">32</option>\n                                <option value="33">33</option>\n                                <option value="34">34</option>\n                                <option value="35">35</option>\n                                <option value="36">36</option>\n                                <option value="37">37</option>\n                                <option value="38">38</option>\n                                <option value="39">39</option>\n                                <option value="40">40</option>\n                                <option value="41">41</option>\n                                <option value="42">42</option>\n                                <option value="43">43</option>\n                                <option value="44">44</option>\n                                <option value="45">45</option>\n                            </select>\n                        </div>\n                        <label class="am-u-sm-3 am-form-label">\n                            <input type="hidden" name="is-gift" class="is-gift">\n                            <input type="hidden" name="is-shipping" class="is-shipping">\n                            <label><input class="ckb-is-gift" type="checkbox"> 赠品</label>\n                            <span class="split"></span>\n                            <label><input class="ckb-is-shipping" type="checkbox"> 已发货</label>\n                            <span class="split"></span>\n                            <a href="javascript:;" class="remove">删除</a>\n                        </label>\n                    </div>\n            ';$(".order-add").click(function(){var r=$(n);e.append(r),t.bindOrderNameTypeAhead(r.find(".name")),r.find("input[name=name]").get(0).focus()}),e.on("click",".remove",function(){$(this).parents(".list-group-field").detach()});var r=$("#content-name");r.on("click",".ckb-is-shipping",function(){var t=$(this).parents(".list-group-field").index();this.checked?$(".is-shipping").eq(t).val(1):$(".is-shipping").eq(t).val(0)}),r.on("click",".ckb-is-gift",function(){var t=$(this).parents(".list-group-field").index();this.checked?$(".is-gift").eq(t).val(1):$(".is-gift").eq(t).val(0)});var i=$(".address-list"),a=$("#shipping-address");i.on("click",".remove-address",function(){var t=this,e=$(this).data("index");return 1===i.find(".remove-address").length?window.customerAddress=[]:window.customerAddress.splice(e,1),$.ajax({url:"/order/remove-customer-address",data:{customerId:$("#customer-name-id").val(),address:window.customerAddress},success:function(e){$(t).parents("li").detach(),a.val("").get(0).focus(),window.customerAddress=[],i.find("li").each(function(t,e){window.customerAddress.push($(e).find(".customer-address-list").text()),$(e).find(".remove-address").attr("data-index",t)})}}),!1})},orderTypeAheadAdd:function(){var t=$("#customer-name"),e=$("#customer-name-id"),n=$(".new-customer"),r=$("#shipping-address"),i=$(".address-list"),a=$(".new-address"),o=($(".check-customer-rename"),$(".check-customer-id")),c=$(".ckb-is-taobao-user");t.on({keyup:function(){this.value=$.trim(this.value),$(this).data("typeselect")||(n.prop("checked",!0),a.prop("checked",!0),i.empty())},focus:function(){$(this).data("typeselect",!1)},"typeahead:select":function(t,o){e.val(o.customerId);var s=o.address;window.customerAddress=o.address,i.empty(),c.prop("checked",o.isTaobaoUser),1===s.length&&(r.val(s[0]),a.prop("checked",!1));for(var u=0;u<=s.length-1;u++)i.append('<li><span class="customer-address-list">'+s[u]+'</span> <a class="use-address" href="javascript:;">[使用此地址'+(u===s.length-1?"-<strong>最新</strong>":"")+']</a> <span class="sp"></span> <a data-index="'+u+'" class="remove-address" href="javascript:;">[删除]</a></li>');n.prop("checked",!1),$(this).data("typeselect",!0)},"typeahead:asyncrequest":function(){o.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 淘宝昵称检测中，请稍后...')},"typeahead:asyncreceive":function(){e.parent().find(".tt-menu").hasClass("tt-empty")?o.html('<i class="am-icon-exclamation-circle"></i> 无查询结果，该名称为新用户'):o.removeClass("on").text("")}}),i.on("click",".use-address",function(){r.val($(this).parents("li").find("span").text()),i.empty(),a.prop("checked",!1)}),n.click(function(){this.checked&&(e.val(""),a.prop("checked",!1).click())}),a.click(function(){this.checked&&(r.val("").get(0).focus(),i.empty())}),r.on("change",function(){a.prop("checked",!0)})},orderTypeAheadUpdate:function(){var t=$("#customer-name"),e=$("#customer-name-id"),n=$("#shipping-address"),r=$(".address-list"),i=$(".check-customer-id"),a=$(".ckb-is-taobao-user");t.on({"typeahead:select":function(t,i){e.val(i.customerId),r.empty(),a.prop("checked",i.isTaobaoUser);var o=i.address;if(1===o.length)n.val(o[0]);else for(var c=o.length-1;c>=0;c--)r.append("<li><span>"+o[c]+'</span> <a href="javascript:;">使用此地址'+(c===o.length-1?"(最近更新)":"")+"</a> </li>")},"typeahead:asyncrequest":function(){i.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 淘宝昵称检测中，请稍后...')},"typeahead:asyncreceive":function(){e.parent().find(".tt-menu").hasClass("tt-empty")?i.html('<i class="am-icon-exclamation-circle"></i> 无查询结果，该名称为新用户'):i.removeClass("on").text("")}}),r.on("click","a",function(){n.val($(this).parents("li").find("span").text()),r.empty()})},customerNameTypeAhead:function(){var t=$("#customer-name");t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><span class="tt-value">'+t.value+'</span><span class="tt-footer">'+(t.isTaobaoUser?"(淘宝用户)":" (非淘宝用户) ")+t.address+"</span></div>"}},highlight:!0,source:new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),
queryTokenizer:r.tokenizers.whitespace,remote:{url:"/order/add/search-customer",prepare:function(e,n){return n.data={name:$.trim(t.val())},n}}})})},orderNameTypeAhead:function(){var t=this;$(".name").each(function(e,n){t.bindOrderNameTypeAhead($(n))})},orderBatchAdd:function(){var t=$("#modal-order-batch-add"),e=$("#batch-text"),n=$("#batch-create"),r=$(".order-add");$(".order-batch-add").click(function(){t.modal(),e.val(""),e[0].focus()}),n.click(function(){var i=e.val();if(!$.trim(i)||i.indexOf("商家编码：")<0)return alert("请输入正确的淘宝订单内容!"),!1;if(/订单号/.test(i))for(var a=i.match(/订单号.+[^\n]/gi),o=0;o<a.length;o++)i=i.replace(/订单号.+[^\n]/gi,"");i=i.replace(/\n/gi,""),i=i.replace(/买家已付款[^、)]+\)/gi,""),i=i.replace(/卖家已发货[^、)]+\)/gi,"");var c=i.match(/商家编码：/gi).length,s=i.match(/商家编码：\d+/gi),u=i.match(/￥\d+\.\d+/gi);c!==s.length&&alert("注意：商家编码数据不匹配，请手动检测数据");var d=!0,l=function(){return 2===$(".name").length?0:(d=!1,$(".name").length)}();s=s.map(function(t,e){return r.click(),parseInt(t.replace("商家编码：",""))}),u=u.map(function(t,e){return t=t.replace(/￥\d+\.\d\d/,""),parseInt(t)});var p=$(".name");d||r.click(),$(".remove").last().click();var f=$("select[name=shipping-count]");return n.text("生成订单中..."),setTimeout(function(){$.each(s,function(e,r){$.ajax({url:"/order/product?name="+r,async:!1,success:function(r){p.eq(l+1).val(r[0].value),f.eq(l/2).find("option").eq(u[e]-1).selected(),l+=2,n.text("生成订单"),t.modal("close")}})})},0),!1})},bindOrderNameTypeAhead:function(t){t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><img src="'+t.image+'?imageMogr2/thumbnail/32" />'+t.value+"</div>"}},highlight:!0,source:new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),queryTokenizer:r.tokenizers.whitespace,remote:{url:"/order/product",prepare:function(e,n){return n.data={name:t.val()},n}}})})},clientNameTypeAhead:function(){},clipboard:function(){var t=$("#shipping-address"),e=$(".copy-phone"),n=$(".copy-address"),r=$(".copy-thumb-address"),i=t.val(),a=/\d{11}/;a.test(i)&&e.val(a.exec(i)[0]);var o=t.val(),c=/\d{11}/;c.test(o)&&(o=$.trim(o.replace(/\d{11}/,""))),o=$.trim(o.replace(/(^,|，|\.|。|;|；)|(,|，|\.|。|;|；$)/g,"")),n.val(o);var s=t.val();/\d{11}/.test(s)&&(s=$.trim(s.replace(/\d{11}/,""))),/区/.test(s)&&(s=$.trim(s.replace(/([\s\S]*?区)/,""))),/街道/.test(s)&&(s=$.trim(s.replace(/([\s\S]*?街道)/,""))),s=$.trim(s.replace(/(^,|，|\.|。|;|；)|(,|，|\.|。|;|；$)/g,"")),r.val(s)},checkCustomerRename:function a(t,e){var a=$(".check-customer-rename").removeClass("error");return $.trim(e.value)?(a.addClass("on").html('<i class="am-icon-spinner am-icon-spin"></i> 非淘宝用户名检测中...'),void $.ajax({url:"/order/check-customer-rename",data:{name:t}}).then(function(t){t.customer?a.addClass("error").html('<i class="am-icon-exclamation-circle"></i> 检测出重命名!'):a.html('<i class="am-icon-check"></i> 未检测出重命名')})):(a.removeClass("on"),!1)}}},{"../common/utils":6,bloodhound:10,"jquery-validate":19}],music:[function(t,e,n){"use strict";t("jquery-validate");var r=t("./lib/product-preview");e.exports={indexFun:function(){$(".select-category").change(function(){this.value>0&&(location.href="/product?categoryId="+this.value)}),$(".remove-music").click(function(){var t=$(this);return $("#confirm-remove-music").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-music").validate(),this.formActionSelect()},editFun:function(){$("#form-add-music").validate(),this.formActionSelect()},previewFun:r,formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})}}},{"./lib/product-preview":7,"jquery-validate":19}],index:[function(t,e,n){"use strict";e.exports={indexFun:function(t){var e=echarts.init($("#chart-earning")[0]);e.setOption({title:{text:(new Date).getFullYear()+"年收入明细",textStyle:{fontWeight:"normal",fontSize:12}},tooltip:{trigger:"axis"},legend:{selected:{"支出金额":!0,"收入金额":!0,"盈利":!1},data:["支出","收入","盈利"],right:"0%"},toolbox:{feature:{saveAsImage:{}}},grid:{left:"0%",right:"0%",bottom:"0%",top:"15%",containLabel:!0},xAxis:[{show:!1,type:"category",boundaryGap:!1,data:t.date}],yAxis:[{type:"value"}],series:[{name:"支出",type:"line",areaStyle:{normal:{}},data:t.expenses,itemStyle:{normal:{color:"#0e90d2"}}},{name:"收入",type:"line",areaStyle:{normal:{}},data:t.income,itemStyle:{normal:{color:"#5eb95e"}}},{name:"盈利",type:"line",areaStyle:{normal:{}},data:t.earning,itemStyle:{normal:{color:"#dd514c"}}}]})}}},{}],identity:[function(t,e,n){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-identity").click(function(){var t=$(this);return $("#confirm-remove-identity").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".search-isoften").change(function(){$("form").find(".am-btn").click()})},addFun:function(){$("#form-add-identity").validate()},editFun:function(){$("#form-edit-identity").validate()},uploadImg:function(t){var e=$("#form-upload-img"),n=$("#icon-image"),r=$(".upload-loading");e.submit(function(){return r.addClass("on"),$(this).ajaxSubmit({success:function(e){r.removeClass("on"),e.success&&window.parent[t](e.url)}}),!1}),n.change(function(){e.submit()})}}},{"jquery-form":15,"jquery-validate":19}],"file-manage":[function(t,e,n){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-file-manage").click(function(){var t=$(this);return $("#confirm-remove-file-manage").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-file-manage").validate()},editFun:function(){$("#form-edit-file-manage").validate()},uploadImg:function(t){var e=$("#form-upload-img"),n=$("#icon-image"),r=$(".upload-loading");e.submit(function(){return r.addClass("on"),$(this).ajaxSubmit({success:function(e){r.removeClass("on"),e.success&&window.parent[t](e.url)}}),!1}),n.change(function(){e.submit()})}}},{"jquery-form":15,"jquery-validate":19}],earning:[function(t,e,n){"use strict";t("jquery-validate"),e.exports={indexFun:function(){var t=function(){var t=0;return $(".cell-expenses").each(function(e,n){t+=parseInt($(n).text())}),t}(),e=function(){var t=0;return $(".cell-income").each(function(e,n){t+=parseInt($(n).text())}),t}();$("#month-expenses").text(t),$("#month-income").text(e),$("#month-earning").text(e-t)},editFun:function(){$("#form-edit-earning").validate();var t=($("#expenses"),$("#expenses-comment")),e=/date=(.*)/.exec(location.search)[1];$(".current-day-expenses").click(function(n){$.ajax({url:"/earning/edit/current-day-expenses",data:{date:e},success:function(e){var r=t.val();r=r.replace(/采购金额\:\d+/,"采购金额:"+e.value),t.val(r).trigger("change"),$(n.target).css("font-weight","bold").text("已更新当天采购金额")}})}).trigger("click"),$("#expenses-comment,#income-comment").change(function(){var t=0,e=$(this).parent().prev().prev().find("input[type=text]"),n=this.value.match(/(\d+)/g);if(!n)return void e.val(0);for(var r=0;r<n.length;r++)t+=parseInt(n[r]);e.val(t)})}}},{"jquery-validate":19}],customer:[function(t,e,n){"use strict";t("jquery-validate");var r=t("bloodhound");e.exports={indexFun:function(){var t=$("#modal-alert");$(".remove-customer").click(function(){return $("#confirm-remove-customer").modal({relatedTarget:this,onConfirm:function(e){var n=this,r=$(this.relatedTarget);$.ajax({type:"post",url:"/customer/remove/"+r.data("id"),success:function(e){e.success?location.reload():t.modal({relatedTarget:n}).find(".am-modal-bd").html('无法删除,请先删除该用户所有<a href="/order?search-customer-id='+r.data("id")+'" target="_blank">发货订单</a>后再进行删除')}})},onCancel:function(){return!1}}),!1})},addFun:function(){this.addAddress(),this.customerTypeAhead()},editFun:function(){this.addAddress(),this.customerTypeAhead()},addAddress:function(){var t=$("#content-address"),e=$(".address-add"),n=t.find(".remove");e.click(function(){var t=$(".address-field:last"),e=t.clone(!0);e.insertAfter(t),e.find(".address").val("").get(0).focus()}),n.click(function(){return 1===t.find(".remove").length?!1:void $(this).parents(".address-field").detach()})},customerTypeAhead:function(){var t=$("#parent-customer"),e=$("#parent-customer-id"),n=new r({datumTokenizer:r.tokenizers.obj.whitespace("value"),queryTokenizer:r.tokenizers.whitespace,remote:{url:"/customer/add/customer-parent",prepare:function(e,n){return n.data={name:t.val()},n}}});t.typeahead(null,{display:"value",highlight:!0,source:n}),t.on({"typeahead:select":function(t,n){e.val(n.customerId)},blur:function(){""===$.trim(this.value)&&e.val("")}})}}},{bloodhound:10,"jquery-validate":19}],10:[function(t,e,n){!function(r,i){"function"==typeof define&&define.amd?define("bloodhound",["jquery"],function(t){return r.Bloodhound=i(t)}):"object"==typeof n?e.exports=i(t("jquery")):r.Bloodhound=i(jQuery)}(this,function(t){var e=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,n){function r(t,e){return n(e,t)}t.each(e,r)},map:t.map,filter:t.grep,every:function(e,n){var r=!0;return e?(t.each(e,function(t,i){return(r=n.call(null,i,t,e))?void 0:!1}),!!r):r},some:function(e,n){var r=!1;return e?(t.each(e,function(t,i){return(r=n.call(null,i,t,e))?!1:void 0}),!!r):r},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function(e){function n(){return String(e)}return t.isFunction(e)?e:n},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var r,i;return function(){var a,o,c=this,s=arguments;return a=function(){r=null,n||(i=t.apply(c,s))},o=n&&!r,clearTimeout(r),r=setTimeout(a,e),o&&(i=t.apply(c,s)),i}},throttle:function(t,e){var n,r,i,a,o,c;return o=0,c=function(){o=new Date,i=null,a=t.apply(n,r)},function(){var s=new Date,u=e-(s-o);return n=this,r=arguments,0>=u?(clearTimeout(i),i=null,o=s,a=t.apply(n,r)):i||(i=setTimeout(c,u)),a}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}}}(),n="0.11.1",r=function(){"use strict";function t(t){return t=e.toStr(t),t?t.split(/\s+/):[]}function n(t){return t=e.toStr(t),t?t.split(/\W+/):[]}function r(t){return function(n){return n=e.isArray(n)?n:[].slice.call(arguments,0),function(r){var i=[];return e.each(n,function(n){i=i.concat(t(e.toStr(r[n])))}),i}}}return{nonword:n,whitespace:t,obj:{nonword:r(n),whitespace:r(t)}}}(),i=function(){"use strict";function n(n){this.maxSize=e.isNumber(n)?n:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function r(){this.head=this.tail=null}function i(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(n.prototype,{set:function(t,e){var n,r=this.list.tail;this.size>=this.maxSize&&(this.list.remove(r),delete this.hash[r.key],this.size--),(n=this.hash[t])?(n.val=e,this.list.moveToFront(n)):(n=new i(t,e),this.list.add(n),this.hash[t]=n,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new r}}),e.mixin(r.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),n}(),a=function(){"use strict";function n(t,n){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix)),this.ls=n||c,!this.ls&&this._noop()}function r(){return(new Date).getTime()}function i(t){return JSON.stringify(e.isUndefined(t)?null:t)}function a(e){return t.parseJSON(e)}function o(t){var e,n,r=[],i=c.length;for(e=0;i>e;e++)(n=c.key(e)).match(t)&&r.push(n.replace(t,""));return r}var c;try{c=window.localStorage,c.setItem("~~~","!"),c.removeItem("~~~")}catch(s){c=null}return e.mixin(n.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(n){"QuotaExceededError"===n.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),a(this.ls.getItem(this._prefix(t)))},set:function(t,n,a){return e.isNumber(a)?this._safeSet(this._ttlKey(t),i(r()+a)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),i(n))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var t,e=o(this.keyMatcher);for(t=e.length;t--;)this.remove(e[t]);return this},isExpired:function(t){var n=a(this.ls.getItem(this._ttlKey(t)));return e.isNumber(n)&&r()>n?!0:!1}}),n}(),o=function(){"use strict";function n(t){t=t||{},this.cancelled=!1,this.lastReq=null,this._send=t.transport,this._get=t.limiter?t.limiter(this._get):this._get,this._cache=t.cache===!1?new i(0):c}var r=0,a={},o=6,c=new i(10);return n.setMaxPendingRequests=function(t){o=t},n.resetCache=function(){c.reset()},e.mixin(n.prototype,{_fingerprint:function(e){return e=e||{},e.url+e.type+t.param(e.data||{})},_get:function(t,e){function n(t){e(null,t),d._cache.set(s,t)}function i(){e(!0)}function c(){r--,delete a[s],d.onDeckRequestArgs&&(d._get.apply(d,d.onDeckRequestArgs),d.onDeckRequestArgs=null)}var s,u,d=this;s=this._fingerprint(t),this.cancelled||s!==this.lastReq||((u=a[s])?u.done(n).fail(i):o>r?(r++,a[s]=this._send(t).done(n).fail(i).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(n,r){var i,a;r=r||t.noop,n=e.isString(n)?{url:n}:n||{},a=this._fingerprint(n),this.cancelled=!1,this.lastReq=a,(i=this._cache.get(a))?r(null,i):this._get(n,r)},cancel:function(){this.cancelled=!0}}),n}(),c=window.SearchIndex=function(){"use strict";function n(n){n=n||{},n.datumTokenizer&&n.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.identify=n.identify||e.stringify,this.datumTokenizer=n.datumTokenizer,this.queryTokenizer=n.queryTokenizer,this.reset()}function r(t){return t=e.filter(t,function(t){return!!t}),t=e.map(t,function(t){return t.toLowerCase()})}function i(){var t={};return t[s]=[],t[c]={},t}function a(t){for(var e={},n=[],r=0,i=t.length;i>r;r++)e[t[r]]||(e[t[r]]=!0,n.push(t[r]));return n}function o(t,e){var n=0,r=0,i=[];t=t.sort(),e=e.sort();for(var a=t.length,o=e.length;a>n&&o>r;)t[n]<e[r]?n++:t[n]>e[r]?r++:(i.push(t[n]),n++,r++);return i}var c="c",s="i";return e.mixin(n.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var n=this;t=e.isArray(t)?t:[t],e.each(t,function(t){var a,o;n.datums[a=n.identify(t)]=t,o=r(n.datumTokenizer(t)),e.each(o,function(t){var e,r,o;for(e=n.trie,r=t.split("");o=r.shift();)e=e[c][o]||(e[c][o]=i()),e[s].push(a)})})},get:function(t){var n=this;return e.map(t,function(t){return n.datums[t]})},search:function(t){var n,i,u=this;return n=r(this.queryTokenizer(t)),e.each(n,function(t){var e,n,r,a;if(i&&0===i.length)return!1;for(e=u.trie,n=t.split("");e&&(r=n.shift());)e=e[c][r];return e&&0===n.length?(a=e[s].slice(0),void(i=i?o(i,a):a)):(i=[],!1)}),i?e.map(a(i),function(t){return u.datums[t]}):[]},all:function(){var t=[];for(var e in this.datums)t.push(this.datums[e]);return t},reset:function(){this.datums={},this.trie=i()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),n}(),s=function(){"use strict";function t(t){this.url=t.url,this.ttl=t.ttl,this.cache=t.cache,this.prepare=t.prepare,this.transform=t.transform,this.transport=t.transport,this.thumbprint=t.thumbprint,this.storage=new a(t.cacheKey)}var n;return n={data:"data",protocol:"protocol",thumbprint:"thumbprint"},e.mixin(t.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(n.data,t,this.ttl),this.storage.set(n.protocol,location.protocol,this.ttl),this.storage.set(n.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var t,e={};return this.cache?(e.data=this.storage.get(n.data),e.protocol=this.storage.get(n.protocol),e.thumbprint=this.storage.get(n.thumbprint),t=e.thumbprint!==this.thumbprint||e.protocol!==location.protocol,e.data&&!t?e.data:null):null},fromNetwork:function(t){function e(){t(!0)}function n(e){t(null,i.transform(e))}var r,i=this;t&&(r=this.prepare(this._settings()),this.transport(r).fail(e).done(n))},clear:function(){return this.storage.clear(),this}}),t}(),u=function(){"use strict";function t(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new o({cache:t.cache,limiter:t.limiter,transport:t.transport})}return e.mixin(t.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(t,e){function n(t,n){e(t?[]:i.transform(n))}var r,i=this;return e?(t=t||"",r=this.prepare(t,this._settings()),this.transport.get(r,n)):void 0},cancelLastRequest:function(){this.transport.cancel()}}),t}(),d=function(){"use strict";function r(r){var i;return r?(i={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null},r=e.isString(r)?{url:r}:r,r=e.mixin(i,r),!r.url&&t.error("prefetch requires url to be set"),r.transform=r.filter||r.transform,r.cacheKey=r.cacheKey||r.url,r.thumbprint=n+r.thumbprint,r.transport=r.transport?c(r.transport):t.ajax,r):null}function i(n){var r;return n?(r={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},n=e.isString(n)?{url:n}:n,n=e.mixin(r,n),!n.url&&t.error("remote requires url to be set"),n.transform=n.filter||n.transform,n.prepare=a(n),n.limiter=o(n),n.transport=n.transport?c(n.transport):t.ajax,delete n.replace,delete n.wildcard,delete n.rateLimitBy,delete n.rateLimitWait,n):void 0}function a(t){function e(t,e){return e.url=a(e.url,t),e}function n(t,e){return e.url=e.url.replace(o,encodeURIComponent(t)),e}function r(t,e){return e}var i,a,o;return i=t.prepare,a=t.replace,o=t.wildcard,i?i:i=a?e:t.wildcard?n:r}function o(t){function n(t){return function(n){return e.debounce(n,t)}}function r(t){return function(n){return e.throttle(n,t)}}var i,a,o;return i=t.limiter,a=t.rateLimitBy,o=t.rateLimitWait,i||(i=/^throttle$/i.test(a)?r(o):n(o)),i}function c(n){return function(r){function i(t){e.defer(function(){o.resolve(t)})}function a(t){e.defer(function(){o.reject(t)})}var o=t.Deferred();return n(r,i,a),o}}return function(n){var a,o;return a={initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},n=e.mixin(a,n||{}),!n.datumTokenizer&&t.error("datumTokenizer is required"),!n.queryTokenizer&&t.error("queryTokenizer is required"),o=n.sorter,n.sorter=o?function(t){return t.sort(o)}:e.identity,n.local=e.isFunction(n.local)?n.local():n.local,n.prefetch=r(n.prefetch),n.remote=i(n.remote),n}}(),l=function(){"use strict";function n(t){t=d(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new u(t.remote):null,this.prefetch=t.prefetch?new s(t.prefetch):null,this.index=new c({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),t.initialize!==!1&&this.initialize()}var i;return i=window&&window.Bloodhound,n.noConflict=function(){return window&&(window.Bloodhound=i),n},n.tokenizers=r,e.mixin(n.prototype,{__ttAdapter:function(){function t(t,e,r){return n.search(t,e,r)}function e(t,e){return n.search(t,e)}var n=this;return this.remote?t:e},_loadPrefetch:function(){function e(t,e){return t?n.reject():(i.add(e),i.prefetch.store(i.index.serialize()),void n.resolve())}var n,r,i=this;return n=t.Deferred(),this.prefetch?(r=this.prefetch.fromCache())?(this.index.bootstrap(r),n.resolve()):this.prefetch.fromNetwork(e):n.resolve(),n.promise()},_initialize:function(){function t(){e.add(e.local)}var e=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(t),this.initPromise},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){return this.index.add(t),this},get:function(t){return t=e.isArray(t)?t:[].slice.call(arguments),this.index.get(t)},search:function(t,n,r){function i(t){var n=[];e.each(t,function(t){!e.some(a,function(e){return o.identify(t)===o.identify(e)})&&n.push(t)}),r&&r(n)}var a,o=this;return a=this.sorter(this.index.search(t)),n(this.remote?a.slice():a),this.remote&&a.length<this.sufficient?this.remote.get(t,i):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return o.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),n}();return l})},{jquery:18}],book:[function(t,e,n){"use strict";t("jquery-validate");var r=t("./lib/product-preview");e.exports={indexFun:function(){$(".remove-book").click(function(){var t=$(this);return $("#confirm-remove-book").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-book").validate(),this.formActionSelect()},editFun:function(){$("#form-add-book").validate(),this.formActionSelect()},previewFun:r,formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})}}},{"./lib/product-preview":7,"jquery-validate":19}],7:[function(t,e,n){"use strict";e.exports=function(){var t=$(".preview-content"),e=$.trim(t.html()),n=$(".btn-copy");n.zclip({path:"/assets/swf/ZeroClipboard.swf",copy:function(){return e},afterCopy:function(){n.popover({content:"复制成功!"})}});var r=$(".btn-shot");r.button("loading");var i=$.AMUI.progress;$("p img").wrap('<span class="img-mark"></span>'),$(".img-mark").append("<em></em>"),window.onload=function(){r.button("reset"),r.click(function(){i.start(),r.button("loading").text("图片生成中..."),$.ajax({url:"/product/preview/shot",type:"post",data:{html:e,htmlHeight:t.height(),name:$("h4").text()},success:function(t){i.done(),$("#modal-shot-success").modal(),r.button("reset").text("生成淘宝详情图片")}})})}}},{}],1:[function(t,e,n){(function(t,n){!function(){function r(){}function i(t){return t}function a(t){return!!t}function o(t){return!t}function c(t){return function(){if(null===t)throw new Error("Callback was already called.");t.apply(this,arguments),t=null}}function s(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}function u(t){return N(t)||"number"==typeof t.length&&t.length>=0&&t.length%1===0}function d(t,e){for(var n=-1,r=t.length;++n<r;)e(t[n],n,t)}function l(t,e){for(var n=-1,r=t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function p(t){return l(Array(t),function(t,e){return e})}function f(t,e,n){return d(t,function(t,r,i){n=e(n,t,r,i)}),n}function h(t,e){d(P(t),function(n){e(t[n],n)})}function m(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function v(t){var e,n,r=-1;return u(t)?(e=t.length,function(){return r++,e>r?r:null}):(n=P(t),e=n.length,function(){return r++,e>r?n[r]:null})}function g(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;n>i;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r)}}}function $(t){return function(e,n,r){return t(e,r)}}function y(t){return function(e,n,i){i=s(i||r),e=e||[];var a=v(e);if(0>=t)return i(null);var o=!1,u=0,d=!1;!function l(){if(o&&0>=u)return i(null);for(;t>u&&!d;){var r=a();if(null===r)return o=!0,void(0>=u&&i(null));u+=1,n(e[r],r,c(function(t){u-=1,t?(i(t),d=!0):l()}))}}()}}function k(t){return function(e,n,r){return t(M.eachOf,e,n,r)}}function b(t){return function(e,n,r,i){return t(y(n),e,r,i)}}function x(t){return function(e,n,r){return t(M.eachOfSeries,e,n,r)}}function w(t,e,n,i){i=s(i||r),e=e||[];var a=u(e)?[]:{};t(e,function(t,e,r){n(t,function(t,n){a[e]=n,r(t)})},function(t){i(t,a)})}function C(t,e,n,r){var i=[];t(e,function(t,e,r){n(t,function(n){n&&i.push({index:e,value:t}),r()})},function(){r(l(i.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})}function T(t,e,n,r){C(t,e,function(t,e){n(t,function(t){e(!t)})},r)}function j(t,e,n){return function(r,i,a,o){function c(){o&&o(n(!1,void 0))}function s(t,r,i){return o?void a(t,function(r){o&&e(r)&&(o(n(!0,t)),o=a=!1),i()}):i()}arguments.length>3?t(r,i,s,c):(o=a,a=i,t(r,s,c))}}function I(t,e){return e}function A(t,e,n){n=n||r;var i=u(e)?[]:{};t(e,function(t,e,n){t(g(function(t,r){r.length<=1&&(r=r[0]),i[e]=r,n(t)}))},function(t){n(t,i)})}function q(t,e,n,r){var i=[];t(e,function(t,e,r){n(t,function(t,e){i=i.concat(e||[]),r(t)})},function(t){r(t,i)})}function S(t,e,n){function i(t,e,n,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");return t.started=!0,N(e)||(e=[e]),0===e.length&&t.idle()?M.setImmediate(function(){t.drain()}):(d(e,function(e){var a={data:e,callback:i||r};n?t.tasks.unshift(a):t.tasks.push(a),t.tasks.length===t.concurrency&&t.saturated()}),void M.setImmediate(t.process))}function a(t,e){return function(){o-=1;var n=!1,r=arguments;d(e,function(t){d(s,function(e,r){e!==t||n||(s.splice(r,1),n=!0)}),t.callback.apply(t,r)}),t.tasks.length+o===0&&t.drain(),t.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var o=0,s=[],u={tasks:[],concurrency:e,payload:n,saturated:r,empty:r,drain:r,started:!1,paused:!1,push:function(t,e){i(u,t,!1,e)},kill:function(){u.drain=r,u.tasks=[]},unshift:function(t,e){i(u,t,!0,e)},process:function(){for(;!u.paused&&o<u.concurrency&&u.tasks.length;){var e=u.payload?u.tasks.splice(0,u.payload):u.tasks.splice(0,u.tasks.length),n=l(e,function(t){return t.data});0===u.tasks.length&&u.empty(),o+=1,s.push(e[0]);var r=c(a(u,e));t(n,r)}},length:function(){return u.tasks.length},running:function(){return o},workersList:function(){return s},idle:function(){return u.tasks.length+o===0},pause:function(){u.paused=!0},resume:function(){if(u.paused!==!1){u.paused=!1;for(var t=Math.min(u.concurrency,u.tasks.length),e=1;t>=e;e++)M.setImmediate(u.process)}}};return u}function F(t){return g(function(e,n){e.apply(null,n.concat([g(function(e,n){"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&d(n,function(e){console[t](e)}))})]))})}function z(t){return function(e,n,r){t(p(e),n,r)}}function O(t){return g(function(e,n){var r=g(function(n){var r=this,i=n.pop();return t(e,function(t,e,i){t.apply(r,n.concat([i]))},i)});return n.length?r.apply(this,n):r})}function _(t){return g(function(e){var n=e.pop();e.push(function(){var t=arguments;r?M.setImmediate(function(){n.apply(null,t)}):n.apply(null,t)});var r=!0;t.apply(this,e),r=!1})}var U,M={},D="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;null!=D&&(U=D.async),M.noConflict=function(){return D.async=U,M};var E=Object.prototype.toString,N=Array.isArray||function(t){return"[object Array]"===E.call(t)},L=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},P=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},R="function"==typeof setImmediate&&setImmediate,B=R?function(t){R(t)}:function(t){setTimeout(t,0)};"object"==typeof t&&"function"==typeof t.nextTick?M.nextTick=t.nextTick:M.nextTick=B,M.setImmediate=R?B:M.nextTick,M.forEach=M.each=function(t,e,n){return M.eachOf(t,$(e),n)},M.forEachSeries=M.eachSeries=function(t,e,n){return M.eachOfSeries(t,$(e),n)},M.forEachLimit=M.eachLimit=function(t,e,n,r){return y(e)(t,$(n),r)},M.forEachOf=M.eachOf=function(t,e,n){function i(t){u--,t?n(t):null===a&&0>=u&&n(null)}n=s(n||r),t=t||[];for(var a,o=v(t),u=0;null!=(a=o());)u+=1,e(t[a],a,c(i));0===u&&n(null)},M.forEachOfSeries=M.eachOfSeries=function(t,e,n){function i(){var r=!0;return null===o?n(null):(e(t[o],o,c(function(t){if(t)n(t);else{if(o=a(),null===o)return n(null);r?M.setImmediate(i):i()}})),void(r=!1))}n=s(n||r),t=t||[];var a=v(t),o=a();i()},M.forEachOfLimit=M.eachOfLimit=function(t,e,n,r){y(e)(t,n,r)},M.map=k(w),M.mapSeries=x(w),M.mapLimit=b(w),M.inject=M.foldl=M.reduce=function(t,e,n,r){M.eachOfSeries(t,function(t,r,i){n(e,t,function(t,n){e=n,i(t)})},function(t){r(t,e)})},M.foldr=M.reduceRight=function(t,e,n,r){var a=l(t,i).reverse();M.reduce(a,e,n,r)},M.transform=function(t,e,n,r){3===arguments.length&&(r=n,n=e,e=N(t)?[]:{}),M.eachOf(t,function(t,r,i){n(e,t,r,i)},function(t){r(t,e)})},M.select=M.filter=k(C),M.selectLimit=M.filterLimit=b(C),M.selectSeries=M.filterSeries=x(C),M.reject=k(T),M.rejectLimit=b(T),M.rejectSeries=x(T),M.any=M.some=j(M.eachOf,a,i),M.someLimit=j(M.eachOfLimit,a,i),M.all=M.every=j(M.eachOf,o,o),M.everyLimit=j(M.eachOfLimit,o,o),M.detect=j(M.eachOf,i,I),M.detectSeries=j(M.eachOfSeries,i,I),M.detectLimit=j(M.eachOfLimit,i,I),M.sortBy=function(t,e,n){function r(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0}M.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){return t?n(t):void n(null,l(e.sort(r),function(t){return t.value}))})},M.auto=function(t,e,n){function i(t){$.unshift(t)}function a(t){var e=m($,t);e>=0&&$.splice(e,1)}function o(){u--,d($.slice(0),function(t){t()})}"function"==typeof arguments[1]&&(n=e,e=null),n=s(n||r);var c=P(t),u=c.length;if(!u)return n(null);e||(e=u);var l={},p=0,v=!1,$=[];i(function(){u||n(null,l)}),d(c,function(r){function c(){return e>p&&f(y,function(t,e){return t&&l.hasOwnProperty(e)},!0)&&!l.hasOwnProperty(r)}function s(){c()&&(p++,a(s),d[d.length-1]($,l))}if(!v){for(var u,d=N(t[r])?t[r]:[t[r]],$=g(function(t,e){if(p--,e.length<=1&&(e=e[0]),t){var i={};h(l,function(t,e){i[e]=t}),i[r]=e,v=!0,n(t,i)}else l[r]=e,M.setImmediate(o)}),y=d.slice(0,d.length-1),k=y.length;k--;){if(!(u=t[y[k]]))throw new Error("Has nonexistent dependency in "+y.join(", "));if(N(u)&&m(u,r)>=0)throw new Error("Has cyclic dependencies")}c()?(p++,d[d.length-1]($,l)):i(s)}})},M.retry=function(t,e,n){function r(t,e){if("number"==typeof e)t.times=parseInt(e,10)||a;else{if("object"!=typeof e)throw new Error("Unsupported argument type for 'times': "+typeof e);t.times=parseInt(e.times,10)||a,t.interval=parseInt(e.interval,10)||o}}function i(t,e){function n(t,n){return function(r){t(function(t,e){r(!t||n,{err:t,result:e})},e)}}function r(t){return function(e){setTimeout(function(){e(null)},t)}}for(;s.times;){var i=!(s.times-=1);c.push(n(s.task,i)),!i&&s.interval>0&&c.push(r(s.interval))}M.series(c,function(e,n){n=n[n.length-1],(t||s.callback)(n.err,n.result)})}var a=5,o=0,c=[],s={times:a,interval:o},u=arguments.length;if(1>u||u>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return 2>=u&&"function"==typeof t&&(n=e,e=t),"function"!=typeof t&&r(s,t),s.callback=n,s.task=e,s.callback?i():i},M.waterfall=function(t,e){function n(t){return g(function(r,i){if(r)e.apply(null,[r].concat(i));else{var a=t.next();a?i.push(n(a)):i.push(e),_(t).apply(null,i)}})}if(e=s(e||r),!N(t)){var i=new Error("First argument to waterfall must be an array of functions");return e(i);
}return t.length?void n(M.iterator(t))():e()},M.parallel=function(t,e){A(M.eachOf,t,e)},M.parallelLimit=function(t,e,n){A(y(e),t,n)},M.series=function(t,e){A(M.eachOfSeries,t,e)},M.iterator=function(t){function e(n){function r(){return t.length&&t[n].apply(null,arguments),r.next()}return r.next=function(){return n<t.length-1?e(n+1):null},r}return e(0)},M.apply=g(function(t,e){return g(function(n){return t.apply(null,e.concat(n))})}),M.concat=k(q),M.concatSeries=x(q),M.whilst=function(t,e,n){if(n=n||r,t()){var i=g(function(r,a){r?n(r):t.apply(this,a)?e(i):n.apply(null,[null].concat(a))});e(i)}else n(null)},M.doWhilst=function(t,e,n){var r=0;return M.whilst(function(){return++r<=1||e.apply(this,arguments)},t,n)},M.until=function(t,e,n){return M.whilst(function(){return!t.apply(this,arguments)},e,n)},M.doUntil=function(t,e,n){return M.doWhilst(t,function(){return!e.apply(this,arguments)},n)},M.during=function(t,e,n){n=n||r;var i=g(function(e,r){e?n(e):(r.push(a),t.apply(this,r))}),a=function(t,r){t?n(t):r?e(i):n(null)};t(a)},M.doDuring=function(t,e,n){var r=0;M.during(function(t){r++<1?t(null,!0):e.apply(this,arguments)},t,n)},M.queue=function(t,e){var n=S(function(e,n){t(e[0],n)},e,1);return n},M.priorityQueue=function(t,e){function n(t,e){return t.priority-e.priority}function i(t,e,n){for(var r=-1,i=t.length-1;i>r;){var a=r+(i-r+1>>>1);n(e,t[a])>=0?r=a:i=a-1}return r}function a(t,e,a,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return t.started=!0,N(e)||(e=[e]),0===e.length?M.setImmediate(function(){t.drain()}):void d(e,function(e){var c={data:e,priority:a,callback:"function"==typeof o?o:r};t.tasks.splice(i(t.tasks,c,n)+1,0,c),t.tasks.length===t.concurrency&&t.saturated(),M.setImmediate(t.process)})}var o=M.queue(t,e);return o.push=function(t,e,n){a(o,t,e,n)},delete o.unshift,o},M.cargo=function(t,e){return S(t,1,e)},M.log=F("log"),M.dir=F("dir"),M.memoize=function(t,e){var n={},r={},a=Object.prototype.hasOwnProperty;e=e||i;var o=g(function(i){var o=i.pop(),c=e.apply(null,i);a.call(n,c)?M.setImmediate(function(){o.apply(null,n[c])}):a.call(r,c)?r[c].push(o):(r[c]=[o],t.apply(null,i.concat([g(function(t){n[c]=t;var e=r[c];delete r[c];for(var i=0,a=e.length;a>i;i++)e[i].apply(null,t)})])))});return o.memo=n,o.unmemoized=t,o},M.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},M.times=z(M.map),M.timesSeries=z(M.mapSeries),M.timesLimit=function(t,e,n,r){return M.mapLimit(p(t),e,n,r)},M.seq=function(){var t=arguments;return g(function(e){var n=this,i=e[e.length-1];"function"==typeof i?e.pop():i=r,M.reduce(t,e,function(t,e,r){e.apply(n,t.concat([g(function(t,e){r(t,e)})]))},function(t,e){i.apply(n,[t].concat(e))})})},M.compose=function(){return M.seq.apply(null,Array.prototype.reverse.call(arguments))},M.applyEach=O(M.eachOf),M.applyEachSeries=O(M.eachOfSeries),M.forever=function(t,e){function n(t){return t?i(t):void a(n)}var i=c(e||r),a=_(t);n()},M.ensureAsync=_,M.constant=g(function(t){var e=[null].concat(t);return function(t){return t.apply(this,e)}}),M.wrapSync=M.asyncify=function(t){return g(function(e){var n,r=e.pop();try{n=t.apply(this,e)}catch(i){return r(i)}L(n)&&"function"==typeof n.then?n.then(function(t){r(null,t)})["catch"](function(t){r(t.message?t:new Error(t))}):r(null,n)})},"object"==typeof e&&e.exports?e.exports=M:"function"==typeof define&&define.amd?define([],function(){return M}):D.async=M}()}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function o(t){if(p===clearTimeout)return clearTimeout(t);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function c(){v&&h&&(v=!1,h.length?m=h.concat(m):g=-1,m.length&&s())}function s(){if(!v){var t=a(c);v=!0;for(var e=m.length;e;){for(h=m,m=[];++g<e;)h&&h[g].run();g=-1,e=m.length}h=null,v=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function d(){}var l,p,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(t){p=i}}();var h,m=[],v=!1,g=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new u(t,e)),1!==m.length||v||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.prependListener=d,f.prependOnceListener=d,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}]},{},[8]);