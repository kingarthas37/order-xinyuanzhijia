require=function e(n,o,t){function r(i,c){if(!o[i]){if(!n[i]){var l="function"==typeof require&&require;if(!c&&l)return l(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var s=o[i]={exports:{}};n[i][0].call(s.exports,function(e){var o=n[i][1][e];return r(o?o:e)},s,s.exports,e,n,o,t)}return o[i].exports}for(var a="function"==typeof require&&require,i=0;i<t.length;i++)r(t[i]);return r}({3:[function(e,n,o){"use strict";e("../../../js/main"),e("./config"),e("./common"),e("./utils")},{"../../../js/main":19,"./common":1,"./config":2,"./utils":4}],2:[function(e,n,o){"use strict";window.assets={"no-image-src":"http://ac-JoaBcRTt.clouddn.com/b7f0d580ef9a4ae8e19b.png"};var t="order-51wish";window.env=function(){return location.hostname===t+".leanapp.cn"||location.hostname===t+".cn"||location.host==="www."+t+".cn"?"production":location.hostname==="stg-"+t+".leanapp.cn"?"stage":"development"};var r=function(){return"production"===env()?"//order-51wish.leanapp.cn/1.1/functions/":"stage"===env()?"//stg-order-51wish.leanapp.cn/1.1/functions/":"/1.1/functions/"};window.leanApp={appdId:"JoaBcRTtJUNAV1bLpqv8z1ze-gzGzoHsz",api:"https://leancloud.cn/1.1/",cloud:r()},window.leanAppHeader={"x-lc-id":leanApp.appdId,"x-lc-sign":$.cookie("x_lc_sign")||"","x-lc-session":$.cookie("x_lc_session")||"","x-lc-prod":"production"===env()?1:0,"content-type":"application/json"}},{}],1:[function(e,n,o){"use strict";var t=e("amazeui");$(function(){!function(){for(var e,n=function(){},o=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],t=o.length,r=window.console=window.console||{};t--;)e=o[t],r[e]||(r[e]=n)}(),$.extend($.validator.messages,{required:"必选字段",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",maxlength:jQuery.validator.format("请输入一个 长度最多是 {0} 的字符串"),minlength:jQuery.validator.format("请输入一个 长度最少是 {0} 的字符串"),rangelength:jQuery.validator.format("请输入 一个长度介于 {0} 和 {1} 之间的字符串"),range:jQuery.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:jQuery.validator.format("请输入一个最大为{0} 的值"),min:jQuery.validator.format("请输入一个最小为{0} 的值")}),t.plugin("amuiSelected",t.selected),$("[data-am-selected]").amuiSelected(),$(".am-alert.am-alert-success").length&&setTimeout(function(){$(".am-alert.am-alert-success").hide()},3e3)})},{amazeui:7}]},{},[3]);
require=function t(e,r,n){function a(o,c){if(!r[o]){if(!e[o]){var s="function"==typeof require&&require;if(!c&&s)return s(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[o]={exports:{}};e[o][0].call(d.exports,function(t){var r=e[o][1][t];return a(r?r:t)},d,d.exports,t,e,r,n)}return r[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({6:[function(t,e,r){"use strict";t("../../../js/main"),t("./index"),t("./sign"),t("./product"),t("./book"),t("./music"),t("./purchase"),t("./customer"),t("./order"),t("./earning"),t("./remark"),t("./product-method"),t("./product-category"),t("./taobao-mail-create"),t("./product-book"),t("./product-brand"),t("./record"),t("./record-category"),t("./identity"),t("./file-manage")},{"../../../js/main":19,"./book":"book","./customer":"customer","./earning":"earning","./file-manage":"file-manage","./identity":"identity","./index":"index","./music":"music","./order":"order","./product":"product","./product-book":"product-book","./product-brand":"product-brand","./product-category":"product-category","./product-method":"product-method","./purchase":"purchase","./record":"record","./record-category":"record-category","./remark":"remark","./sign":"sign","./taobao-mail-create":"taobao-mail-create"}],"taobao-mail-create":[function(t,e,r){"use strict";var n=(t("swfobject"),t("flash-detect"));e.exports=function(){function t(t){t=$.trim(t),t.replace(/#{4,6}([^\n]+)\n((?:[^#####])+)/g,function(t,e,r){var n={};return n.title=encodeURIComponent($.trim(e)),r=$.trim(r),r=r.replace(/(http[^密]*)/g,function(t,e){return e=$.trim(e),'<a target="_blank" href="'+e+'">'+e+"</a> "}),r=r.replace(/(密码[^\n]+)/g,function(t,e){return e+"<br/>"}),n.content=encodeURIComponent(r),f.push(n),""})}function e(t){t=$.trim(t),t=t.replace(/\n/g,"|");var e=t.split("|"),n=$.grep(e,function(t,e){return t});/订单号/.test(t)&&(m=/订单号: [^\d]*(\d+)/.exec(t)[1]),h=n[4],$.each(n,function(t,e){$.each(f,function(t,r){return encodeURIComponent($.trim(e))==r.title?void p.push(r):void 0})}),r()}function r(){d.load("/assets/templates/taobao-mail.html",function(t){if(!p.length)return alert("数据错误，请检查!"),!1;u.text(i+"-"+decodeURIComponent(p[0].title)+(p.length>1?"等多件":""));var e=d.find(".mail-mx-title").empty(),r=d.find(".mail-mx-content").empty(),n='亲爱的 <strong style="color:#645a7e;">'+(h?h:"")+"</strong> "+(m?"(订单号"+m+")":"")+",以下为您拍下的宝贝:";e.html(n);for(var a="",o=0;o<p.length;o++){a+='<div style="border-bottom: 1px dashed #ccc; margin-bottom: 5px;">',a+='<div style="font-weight: bold; padding:5px; margin:0; ">'+(o+1)+"."+decodeURIComponent(p[o].title)+"</div>";var c=decodeURIComponent(p[o].content);c=c.replace(/\<a/gi,'<a style="color:#645a7e; text-decoration: underline;"'),c=c.replace(/链接\S/g,'<br/>下载链接:<span style="padding-left:6px;"></span>'),c=c.replace(/密码\S([^\n]+)/gi,'<br/>下载密码:<strong style="color:#645a7e;padding-left:6px;">$1</strong><div style="padding-bottom: 6px;"></div>'),a+='<div style="padding:5px; margin:0;">'+c+"</div>",a+="</div>"}r.html(a),r.find("> div:last").css({border:"none",margin:"0"})})}function a(t){l.show().text(t),setTimeout(function(){return l.hide()},3e3)}var i="暮雪的心愿城",o=null,c=$("#btn-create"),s=$("#textarea"),u=$(".mail-title"),d=$(".mail-content"),l=$(".copy-info"),f=[],m="",h="",p=[];if(s[0].focus(),$.ajax({url:"/mail/taobao-mail-create/get-content",success:function(e){t(e.content),c.removeAttr("disabled")},error:function(t,e,r){alert("数据加载出错，请重新刷新页面!("+t+e+r+")")}}),c.click(function(){o=e(s.val())}),n.installed){var v="/assets/swf/ZeroClipboard.swf";$(".copy-title").show().zclip({path:v,copy:function(){return $(".mail-title").text()},afterCopy:function(){a("复制邮件标题成功")}}),$(".copy-wangwang").show().zclip({path:v,copy:function(){return"亲,商品已发送至您此邮箱,请注意查收! ps:如果您是手机端阅读(尤其是iPhone/iPad),请花30秒时间点击下邮件里的在手机中阅读的链接说明,希望本店商品能对亲有帮助哦,并祝亲能收获满满,心想事成,加油!!"},afterCopy:function(){a("复制旺旺回复内容成功!"),setTimeout(function(){location.reload()},1e3)}}),$(".copy-haoping").show().zclip({path:v,copy:function(){return'亲,我们已收到您的好评,感谢您对本店的支持,本店会一如既往地为您服务并会持续上架您喜欢的商品,请继续关注我们哦!以下是店主作为答谢赠送您的"天使音乐":[身体工房馆-天使疗愈花园-召唤天使] 下载链接: http://pan.baidu.com/s/1i31U9VJ 密码: 6882'},afterCopy:function(){a("复制好评回复内容成功")}}),$(".copy-howmail").show().zclip({path:v,copy:function(){return"亲,请问邮箱是多少,我这边可以给亲发货哦"},afterCopy:function(){a("复制询问邮箱成功!")}}),$(".copy-howread").show().zclip({path:v,copy:function(){return"亲此商品为电子版,拍时请留言备注自己的邮箱号,我会把百度云的下载链接发到亲的邮箱里,亲可以保存到自己的百度云或直接下载"},afterCopy:function(){a("复制如何阅读成功!")}}),$(".copy-sendremind").show().zclip({path:v,copy:function(){return"亲你这边一直没有回复我邮箱,我先把下载链接发给亲,如果亲有问题可以再跟我确认哦"},afterCopy:function(){a("复制发货提醒成功!")}})}}},{"flash-detect":9,swfobject:20}],sign:[function(t,e,r){"use strict";t("jquery-validate"),e.exports={loginFun:function(){$("#form-login").validate()},registerFun:function(){$("#form-register").validate()}}},{"jquery-validate":16}],remark:[function(t,e,r){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".ckb-is-complete").click(function(){var t=$(this);$.ajax({url:"/remark/complete",data:{remarkId:t.attr("data-id"),checked:t.prop("checked")},success:function(t){console.info(t)}})}),$(".remove-remark").click(function(){var t=$(this);return $("#confirm-remove-remark").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-remark").validate()},editFun:function(){$("#form-edit-remark").validate()}}},{"jquery-validate":16}],"record-category":[function(t,e,r){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".remove-record-category").click(function(){var t=$(this);return $("#confirm-remove-record-category").modal({relatedTarget:this,onConfirm:function(){$.ajax({url:"/record-category/remove/"+t.attr("data-id"),success:function(t){if(t.success)return location.href="/record-category";var e=$("#alert-remove-record-category");e.find(".am-modal-bd").text(t.msg),e.modal({relatedTarget:this})}})},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-record-category").validate()},editFun:function(){$("#form-edit-record-category").validate()}}},{"jquery-validate":16}],record:[function(t,e,r){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".select-record-category").change(function(){this.value>0&&(location.href="/record?recordCategoryId="+this.value)}),$(".remove-record").click(function(){var t=$(this);return $("#confirm-remove-record").modal({relatedTarget:this,onConfirm:function(){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-record").validate()},editFun:function(){$("#form-edit-record").validate()},uploadImg:function(){var t=$("#form-upload-img"),e=$("#icon-image"),r=$(".upload-loading");t.submit(function(){return r.addClass("on"),$(this).ajaxSubmit({success:function(t){r.removeClass("on"),t.success?window.parent.uploadImgResponse(t.url):window.parent.uploadImgError(t.error)}}),!1}),e.change(function(){t.submit()})},uploadImgResponse:function(t){$("#image").val(t),$(".show-image").html('<img src="'+t+'"/>')},uploadImgError:function(t){var e=$("#alert-image-upload-error");e.find(".am-modal-bd").text(t),e.modal()}}},{"jquery-form":12,"jquery-validate":16}],purchase:[function(t,e,r){"use strict";t("jquery-validate");var n=t("bloodhound");e.exports={indexFun:function(){$(".remove-purchase").click(function(){var t=$(this);return $("#confirm-remove-purchase").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-shipping-status").click(function(){var t=this;$.ajax({url:"/purchase/shipping-status",type:"get",data:{purchaseId:$(this).attr("data-id"),status:this.checked?"arrived":"notarrived"}}).done(function(e){var r=$(t).parents("tr");t.checked?r.addClass("off"):r.removeClass("off")})}),$("#select-site-type").change(function(){return this.value?location.href="/purchase?site-type="+this.value:void(location.href="/purchase")})},addFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead()},editFun:function(){$("#form-add-purchase").validate(),this.purchaseTypeAhead()},purchaseTypeAhead:function(){var t=$("#purchase-description"),e=$("#purchase-website"),r=$("#purchase-mail"),a=$("#purchase-image"),i=$(".purchase-image"),o=location.search.indexOf("etsy")>-1?"etsy":"normal";t.typeahead(null,{display:"value",highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/purchase/add/website-desc",prepare:function(e,r){return r.data={name:t.val(),"site-type":o},r}}})}),t.on({"typeahead:select":function(t,n){e.val(n.website?n.website:n.shop),r.val(n.email),a.val(n.image),i.find("img").attr("src",n.image)}})}}},{bloodhound:8,"jquery-validate":16}],"product-method":[function(t,e,r){"use strict";window.leanAppHeader;e.exports={indexFun:function(){var t=$(".remove-product-method"),e=$("#confirm-remove-product-method"),r=$("#modal-alert");r.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.click(function(){e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget),n=parseInt(t.data("id"));return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.ajax({type:"post",url:"/admin/product-method/remove/"+n,success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?r.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除产品类型成功!"):r.modal().find(".am-modal-bd").text(n.message)}}),!1)}})})},addFun:function(){this.submitControl()},editFun:function(){this.submitControl()},submitControl:function(){var t=$("#submit");$(".am-form").validator({submit:function(){return this.isFormValid()?void t.attr("disabled",!0).addClass("am-disabled"):!1}})}}},{}],"product-category":[function(t,e,r){"use strict";e.exports={indexFun:function(){this.container=$(".am-accordion"),this.selectProductMethod(),this.addCategory1(),this.editCategory1(),this.removeCategory1(),this.moveCategory1Up(),this.moveCategory1Down(),this.addCategory2(),this.editCategory2(),this.removeCategory2(),this.moveCategory2Up(),this.moveCategory2Down()},selectProductMethod:function(){var t=$(".select-product-method");this.productMethodId=t.val()?parseInt(t.val()):0,t.change(function(){location.href="/product-category?product-method-id="+this.value})},addCategory1:function(){var t=$("#modal-category-1-add"),e=$("#input-category-1-add"),r=$("#modal-category-1-confirm-add"),n=this.productMethodId;$(".btn-category-1-add").click(function(){e.val(""),t.modal({relatedTarget:this})}),r.click(function(){return r.data("state")?!1:($.AMUI.progress.start(),r.data("state",!0),$.post({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:JSON.stringify({index:$(".am-accordion-item").length,name:$.trim(e.val())?$.trim(e.val()):"无分类名",productMethodId:n}),success:function(){$.AMUI.progress.done(),r.data("state",!1),t.modal("close"),location.reload()}}),!1)})},editCategory1:function(){var t=$("#modal-category-1-edit"),e=$("#input-category-1-edit"),r=$("#modal-category-1-confirm-edit"),n=$("#modal-alert"),a=this.productMethodId,i=null;$(".edit-category-1").each(function(){$(this).click(function(){var r=$(this).parents(".am-accordion-title").find("strong").text();return e.val($.trim(r)),t.modal({relatedTarget:this}),i=$(this).parents(".am-accordion-item").attr("data-id"),!1})}),r.click(function(){return r.data("state")?!1:($.AMUI.progress.start(),r.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory1",headers:leanAppHeader,data:'where={"category1Id":'+i+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory1/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val()),productMethodId:a})})}).done(function(){r.data("state",!1),$.AMUI.progress.done(),t.modal("close"),n.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("编辑一级分类成功!")}),!1)})},removeCategory1:function(){var t=$(".remove-category-1"),e=$("#modal-category-1-remove"),r=$("#modal-alert");r.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),t.each(function(t,n){$(n).click(function(){$(this);return e.modal({relatedTarget:this,onConfirm:function(){var t=$(this.relatedTarget);return t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/remove-category-1",data:{id:t.parents(".am-accordion-item").attr("data-id")},success:function(n){t.data("state",!1),$.AMUI.progress.done(),e.modal("close"),n.success?r.modal({onConfirm:function(){return location.reload()}}).find(".am-modal-bd").text("删除一级分类成功!"):r.modal().find(".am-modal-bd").text(n.message)}}),!1)}}),!1})})},moveCategory1Up:function(){$(".moveup-category-1").each(function(){$(this).click(function(){var t=$(this),e=t.parents(".am-accordion-item"),r=e.prev(),n=e.attr("data-id"),a=r.attr("data-id"),i=e.index();return 0===i?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-1-up",data:{currentId:n,targetId:a}}).done(function(n){n.success&&(e.after(r),t.data("state",!1),$.AMUI.progress.done())}),!1)})})},moveCategory1Down:function(){var t=$(".am-accordion-item");$(".movedown-category-1").each(function(){$(this).click(function(){var e=$(this),r=e.parents(".am-accordion-item"),n=r.next(),a=r.attr("data-id"),i=n.attr("data-id"),o=r.index();return o===t.length-1?!1:e.data("state")?!1:(e.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-1-down",data:{currentId:a,targetId:i}}).done(function(t){t.success&&(r.before(n),e.data("state",!1),$.AMUI.progress.done())}),!1)})})},addCategory2:function(){var t=$("#modal-category-2-add"),e=$("#input-category-2-add"),r=$("#modal-category-2-confirm-add"),n=null,a=null;$(".btn-category-2-add").each(function(r,i){$(i).click(function(){n=$(this).parents(".am-accordion-item"),a=parseInt(n.attr("data-id")),e.val(""),t.modal({relatedTarget:this})})}),r.click(function(){if(r.data("state"))return!1;$.AMUI.progress.start(),r.data("state",!0);var i=n.find(".category-2-list li").length;return $.post({url:"/product-category/add-category-2",data:{index:i,name:$.trim(e.val())?$.trim(e.val()):"无标题",category1Id:a}}).done(function(e){$.AMUI.progress.done(),r.data("state",!1),t.modal("close");var a=$(".select-product-method").val(),i=n.data("id");n.find(".category-2-list").append('\n                        <li data-id="'+e.id+'">\n                            <strong>\n                                <a href="/product-record?product-method-id='+a+"&category1-id="+i+"&category2-id="+e.id+'" target="_blank">'+e.name+'</a>\n                            </strong>\n                             <a href="/product-record/add?product-method-id='+a+"&category1-id="+i+"&category2-id="+e.id+'" target="_blank">[新建]</a>\n                            <span class="options">\n                                <a class="edit-category-2" href="javascript:;">编辑</a>\n                                <a class="moveup-category-2" href="javascript:;">上移</a>\n                                <a class="movedown-category-2" href="javascript:;">下移</a>\n                                <a class="remove-category-2" href="javascript:;">删除</a>\n                            </span>\n                        </li>\n                ')}),!1})},editCategory2:function(){var t=$("#modal-category-2-edit"),e=$("#input-category-2-edit"),r=$("#modal-category-2-confirm-edit"),n=$("#modal-alert"),a=null,i=null;this.container.on("click",".edit-category-2",function(){return a=$(this).parents("li"),e.val($.trim(a.find("strong").text())),i=a.attr("data-id"),t.modal({relatedTarget:this}),!1}),r.click(function(){return r.data("state")?!1:($.AMUI.progress.start(),r.data("state",!0),$.get({url:leanApp.api+"classes/ProductCategory2",headers:leanAppHeader,data:'where={"category2Id":'+i+"}"}).done(function(t){return $.ajax({type:"PUT",url:leanApp.api+"classes/ProductCategory2/"+t.results[0].objectId,headers:leanAppHeader,data:JSON.stringify({name:$.trim(e.val())})})}).done(function(){r.data("state",!1),$.AMUI.progress.done(),t.modal("close"),n.modal({onConfirm:function(){return a.find("strong a").text(e.val())}}).find(".am-modal-bd").text("编辑二级分类成功!")}),!1)})},removeCategory2:function(){var t=$("#modal-category-2-remove"),e=$("#modal-alert");e.on("closed.modal.amui",function(){$(this).removeData("amui.modal")}),this.container.on("click",".remove-category-2",function(){return t.modal({relatedTarget:this,onConfirm:function(){var r=$(this.relatedTarget),n=r.parents("li");return r.data("state")?!1:(r.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/remove-category-2",data:{category1Id:n.parents(".am-accordion-item").attr("data-id"),category2Id:n.attr("data-id")},success:function(a){r.data("state",!1),$.AMUI.progress.done(),t.modal("close"),a.success?e.modal({onConfirm:function(){return n.detach()}}).find(".am-modal-bd").text("删除二级分类成功!"):e.modal().find(".am-modal-bd").text(a.message)}}),!1)}}),!1})},moveCategory2Up:function(){this.container.on("click",".moveup-category-2",function(){var t=$(this),e=$(this).parents("li"),r=e.attr("data-id"),n=e.prev(),a=n.attr("data-id"),i=e.index();return 0===i?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-2-up",data:{currentId:r,targetId:a}}).done(function(r){r.success&&(e.after(n),t.data("state",!1),$.AMUI.progress.done())}),!1)})},moveCategory2Down:function(){this.container.on("click",".movedown-category-2",function(){var t=$(this),e=$(this).parents("li"),r=e.attr("data-id"),n=e.next(),a=n.attr("data-id"),i=e.index();return i===e.parent().find("li").length-1?!1:t.data("state")?!1:(t.data("state",!0),$.AMUI.progress.start(),$.get({url:"/product-category/move-category-2-down",data:{currentId:r,targetId:a}}).done(function(r){r.success&&(e.before(n),t.data("state",!1),$.AMUI.progress.done())}),!1)})}}},{}],"product-brand":[function(t,e,r){"use strict";t("jquery-validate"),e.exports={indexFun:function(){$(".remove-product-brand").click(function(){var t=$(this);return $("#confirm-remove-product-brand").modal({relatedTarget:this,onConfirm:function(){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-product-brand").validate(),this.setTabs()},editFun:function(){$("#form-edit-product-brand").validate(),this.setTabs()},setTabs:function(){$(".am-tabs").tabs({animation:!1})}}},{"jquery-validate":16}],"product-book":[function(t,e,r){"use strict";t("jquery-validate");var n=t("bloodhound");e.exports={indexFun:function(){$(".remove-product-book").click(function(){var t=$(this);return $("#confirm-remove-product-book").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".ckb-search-state").click(function(){this.checked?location.href="/product-book?search-state=on":location.href="/product-book"})},addFun:function(){$(".product-name").get(0).focus(),$("#form-add-product-book").validate(),this.productEdit(),this.customerTypeAhead()},editFun:function(){$("#form-edit-product-book").validate(),this.productEdit(),this.customerTypeAhead()},productEdit:function(){var t=$(".product-list"),e=t.find(".am-form-group").eq(0);$(".product-add").click(function(){var r=e.clone(!0);t.append(r),r.find(".product-count").val(1),r.find(".product-state").data("checked",!1),r.find(".product-name").val("").get(0).focus()}),t.on("click",".remove",function(){$(this).parents(".am-form-group").detach()}),$(".ckb-product-state").change(function(){var t=$(this).parents(".am-form-group");this.checked?t.find(".product-state").val("on"):t.find(".product-state").val("")})},customerTypeAhead:function(){var t=$("#customer-name"),e=$("#customer-id"),r=$(".customer-info");t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><span class="tt-value">'+t.value+'</span><span class="tt-footer">'+t.address+" "+(t.taobao?"淘宝名:"+t.taobao+" ":" ")+(t.weixin?"微信号:"+t.weixin:"")+"</span></div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/product-book/get-customer-name",prepare:function(e,r){return r.data={name:t.val()},r}}})}),t.on({"typeahead:select":function(t,n){console.info(111),e.val(n.customerId).focus(),r.html('用户信息: 姓名:<a href="/customer/edit/'+n.customerId+'">'+n.value+"</a> | 淘宝号:"+n.taobao+" | 微信号:"+n.weixin+" | 地址:"+n.address)}})}}},{bloodhound:8,"jquery-validate":16}],product:[function(t,e,r){"use strict";t("jquery-validate");var n=t("./lib/product-preview");e.exports={indexFun:function(){$(".select-category").change(function(){this.value>0&&(location.href="/product?categoryId="+this.value)}),$(".remove-product").click(function(){var t=$(this);return $("#confirm-remove-product").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-product").validate(),this.chooseBanner(),this.formActionSelect(),this.setTabs(),this.setMainImage()},editFun:function(){$("#form-add-product").validate(),this.chooseBanner(),this.formActionSelect(),this.setTabs(),this.setMainImage()},previewFun:n,chooseInfo:function(){var t=$("#content-info"),e=$("#md-code-info");e.val("![]("+t.find(".product-title img").attr("src")+")"),t.find(":checkbox").click(function(){this.checked?e.val("![]("+t.find(".product-title img").attr("src")+")"):e.val("")})},chooseBanner:function(){var t,e,r=$("#select-banner"),n=r.find("option").length-1,a=$(".code-banner"),i=$("#md-code-banner");if(0===parseInt(r.val())){var o=Math.floor(Math.random(100)*n);t=r.find("option:eq("+o+")").attr("data-src"),e=r.find("option:eq("+o+")").text(),a.html('<img src="'+t+'"/>'),i.val("!["+e+"]("+t+")")}else t=r.find("option:selected").attr("data-src"),e=r.find("option:selected").text(),a.html('<img src="'+t+'"/>'),i.val("!["+e+"]("+t+")");r.on("change",function(){if(0===parseInt(this.value)){var o=Math.floor(Math.random(100)*n);t=r.find("option:eq("+o+")").attr("data-src"),e=r.find("option:eq("+o+")").text()}else t=r.find("option[value="+this.value+"]").attr("data-src"),e=r.find("option[value="+this.value+"]").text();a.html('<img src="'+t+'"/>'),i.val("!["+e+"]("+t+")")}),$(".banner-enable").click(function(){this.checked?(i.val(""),r.addClass("hide"),a.addClass("hide"),i.addClass("hide")):(r.trigger("change"),r.removeClass("hide"),a.removeClass("hide"),i.removeClass("hide"))})},formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})},setTabs:function(){$(".am-tabs").tabs({animation:!1})},setMainImage:function(){var t=$("#content-main-image").find("ul"),e=$("#main-image");e.change(function(){t.empty();var r=e.val().split("\n");""!==$.trim(r[0])&&$.each(r,function(e,n){t.append('<li><a href="'+r[e]+'" target="_blank"><img src="'+r[e]+'"/></a></li>')})}).trigger("change")}}},{"./lib/product-preview":5,"jquery-validate":16}],order:[function(t,e,r){"use strict";t("jquery-validate");var n=t("bloodhound");e.exports={indexFun:function(){$(".remove-order").click(function(){var t=$(this);return $("#confirm-remove-order").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),!function(){var t=[],e=$(".am-table").find("tr[data-customer-id]");e.each(function(e,r){$(r).data("customer-id")&&t.push($(r).data("customer-id"))}),$.ajax({url:"/order/get-customer",data:{customerListId:t}}).then(function(t){t.success&&$.each(e,function(e,r){var n=parseInt($(r).data("customer-id"));$.each(t.customers,function(t,e){e.customerId===n&&$(r).find(".taobao-name").removeClass("on").text(e.taobao)})})})}(),!function(){var t=[],e=$(".image");e.each(function(e,r){$(r).data("id")&&t.push($(r).data("id"))}),$.ajax({url:"/order/get-image",data:{productId:t}}).then(function(t){t.success&&$.each(e,function(e,r){var n=parseInt($(r).data("id"));if($.isEmptyObject(t.images))$(r).removeClass("on").html('<img src="'+window.assets["no-image-src"]+'?imageMogr2/thumbnail/24"/>');else for(var a in t.images)parseInt(a)===n?$(r).removeClass("on").html('<a href="'+t.images[a]+'" target="_blank"><img src="'+t.images[a]+'?imageMogr2/thumbnail/24"/></a>'):n||$(r).removeClass("on").html('<img src="'+window.assets["no-image-src"]+'?imageMogr2/thumbnail/24"/>')})})}(),$(".update-stock").click(function(){var t=$(this);if(t.data("state"))return!1;t.data("state",!0);var e=t.find(".am-icon").hasClass("on"),r=t.attr("product-id"),n=t.attr("order-id");$.ajax({url:"/order/update-stock",data:{"is-set":e,"product-id":r,"order-id":n},success:function(r){t.data("state",!1),r.success&&(e?t.find(".am-icon").removeClass("on").addClass("off"):t.find(".am-icon").removeClass("off").addClass("on"))}})}),!function(){var t=$("#modal-set-stock"),e=t.find("select[name=stock]"),r=t.find("select[name=sales]"),n=t.find(".stock-minus"),a=t.find(".stock-plus"),i=$(".stock-save"),o=$(".stock-reset");$(".set-stock").click(function(){return t.modal({relatedTarget:this,onCancel:function(){return!1}}),!1}),t.on("open.modal.amui",function(t){var o=$(t.relatedTarget);o.addClass("current");var c=o.attr("product-id");i.attr("product-id",c),$.ajax({type:"get",url:"/order/set-stock",data:{"product-id":c},success:function(t){return t.success?(e.val(t.stock),e.attr("data-stock",t.stock),r.val(t.sales),r.attr("data-sales",t.sales),i.attr("product-id",c),a.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary"),void n.removeAttr("disabled").removeClass("am-btn-default").addClass("am-btn-primary")):!1}})}),t.on("close.modal.amui",function(){$(".set-stock.current").removeClass("current"),e.val(0),e.attr("data-stock",0),r.val(0),r.attr("data-sales",0),i.removeAttr("product-id"),a.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary"),n.attr("disabled","disabled").addClass("am-btn-default").removeClass("am-btn-primary")}),n.click(function(){var t=parseInt(e.val()),n=parseInt(r.val());t>0&&(e.find("option[value="+(t-1)+"]")[0].selected=!0,r.find("option[value="+(n+1)+"]")[0].selected=!0)}),a.click(function(){var t=parseInt(e.val());e.find("option[value="+(t+1)+"]")[0].selected=!0}),i.click(function(){var n=$(this);$.ajax({type:"post",url:"/order/set-stock",data:{"product-id":n.attr("product-id"),stock:e.val(),sales:r.val()},success:function(e){if(e.success){var r=$(".set-stock.current").parents(".order-split").find(".update-stock");r.find(".am-icon").hasClass("off")&&r.trigger("click"),t.modal("close")}}})}),o.click(function(){e.find("option[value="+e.attr("stock")+"]")[0].selected=!0,r.find("option[value="+r.attr("sales")+"]")[0].selected=!0})}(),$(".ckb-notshipped").click(function(){this.checked?location.href="/order?search-notshipped=on":location.href="/order"}),$(".ckb-shipped").click(function(){var t=$(this),e=$(this).attr("order-id"),r=this.checked;$.ajax({type:"post",url:"/order/shipping",data:{"order-id":e,shipping:r},success:function(e){e.success&&(t[0].checked?t.parents("tr").removeClass("off"):t.parents("tr").addClass("off"))}})})},addFun:function(){$("#form-add-order").validate(),this.customerNameTypeAhead(),this.orderTypeAheadAdd(),this.domUpdate(),this.orderNameTypeAhead(),$("input[name]").get(0).focus()},editFun:function(){$("#form-edit-order").validate(),this.customerNameTypeAhead(),this.orderTypeAheadUpdate(),this.domUpdate(),this.orderNameTypeAhead()},domUpdate:function(){var t=this,e=$("#shipping-company"),r=$("#tracking-number");e.change(function(){r.val("").get(0).focus()}),!function(){var e=$(".content-name-group"),r='\n                    <div class="list-group-field am-form-group">\n                        <div class="am-u-sm-10">\n                            <input class="name" name="name" type="text" placeholder="输入订单内容" autocomplete="off">\n                        </div>\n                        <div class="am-u-sm-1">\n                            <select name="shipping-count">\n                                <option value="1">1</option>\n                                <option value="2">2</option>\n                                <option value="3">3</option>\n                                <option value="4">4</option>\n                                <option value="5">5</option>\n                            </select>\n                        </div>\n                        <label class="am-u-sm-1 am-form-label">\n                            <a href="javascript:;" class="remove">- 删除</a>\n                        </label>\n                    </div>\n            ';$(".order-add").click(function(){var n=$(r);e.append(n),t.bindOrderNameTypeAhead(n.find(".name")),n.find("input[name=name]").get(0).focus()}),e.on("click",".remove",function(){$(this).parents(".list-group-field").detach()})}()},orderTypeAheadAdd:function(){var t=$("#customer-name"),e=$("#customer-name-id"),r=$(".new-customer"),n=$("#shipping-address"),a=$(".address-list"),i=$("#taobao"),o=$(".new-address");t.on({keyup:function(){$(this).data("typeselect")||(r.prop("checked",!0),o.prop("checked",!0),a.empty())},focus:function(){$(this).data("typeselect",!1)},"typeahead:select":function(t,c){e.val(c.customerId),i.val(c.taobao);var s=c.address;if(a.empty(),1===s.length)n.val(s[0]),o.prop("checked",!1);else for(var u=0;u<s.length;u++)a.append("<li><span>"+s[u]+'</span> <a href="javascript:;">使用此地址</a> </li>');r.prop("checked",!1),$(this).data("typeselect",!0)}}),a.on("click","a",function(){n.val($(this).parents("li").find("span").text()),a.empty(),o.prop("checked",!1)}),o.click(function(){this.checked&&(n.val("").get(0).focus(),a.empty())}),n.on("change",function(){o.prop("checked",!0)})},orderTypeAheadUpdate:function(){var t=$("#customer-name"),e=$("#customer-name-id"),r=$("#shipping-address"),n=$(".address-list"),a=$("#taobao");t.on({"typeahead:select":function(t,i){e.val(i.customerId),a.val(i.taobao),n.empty();var o=i.address;if(1===o.length)r.val(o[0]);else for(var c=0;c<o.length;c++)n.append("<li><span>"+o[c]+'</span> <a href="javascript:;">使用此地址</a> </li>')}}),n.on("click","a",function(){r.val($(this).parents("li").find("span").text()),n.empty()})},customerNameTypeAhead:function(){var t=$("#customer-name");t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><span class="tt-value">'+t.value+'</span><span class="tt-footer">'+(t.taobao?"(淘宝名:"+t.taobao+") ":"")+t.address+"</span></div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/add/search-customer",prepare:function(e,r){return r.data={name:t.val()},r}}})})},orderNameTypeAhead:function(){var t=this;$(".name").each(function(e,r){t.bindOrderNameTypeAhead($(r))})},bindOrderNameTypeAhead:function(t){t.typeahead(null,{display:function(t){return t.value},templates:{suggestion:function(t){return'<div><img src="'+t.image+'?imageMogr2/thumbnail/32" />'+t.value+" </div>"}},highlight:!0,source:new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/order/product",prepare:function(e,r){return r.data={name:t.val()},r}}})})}}},{bloodhound:8,"jquery-validate":16}],music:[function(t,e,r){"use strict";t("jquery-validate");var n=t("./lib/product-preview");e.exports={indexFun:function(){$(".select-category").change(function(){this.value>0&&(location.href="/product?categoryId="+this.value)}),$(".remove-music").click(function(){var t=$(this);return $("#confirm-remove-music").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-music").validate(),this.formActionSelect()},editFun:function(){$("#form-add-music").validate(),this.formActionSelect();
},previewFun:n,formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})}}},{"./lib/product-preview":5,"jquery-validate":16}],index:[function(t,e,r){"use strict";e.exports={indexFun:function(t){var e=echarts.init($("#chart-earning")[0]);e.setOption({title:{text:"2016年收入明细",textStyle:{fontWeight:"normal",fontSize:12}},tooltip:{trigger:"axis"},legend:{selected:{"支出金额":!0,"收入金额":!0,"盈利":!1},data:["支出","收入","盈利"],right:"0%"},toolbox:{feature:{saveAsImage:{}}},grid:{left:"0%",right:"0%",bottom:"0%",top:"15%",containLabel:!0},xAxis:[{show:!1,type:"category",boundaryGap:!1,data:t.date}],yAxis:[{type:"value"}],series:[{name:"支出",type:"line",areaStyle:{normal:{}},data:t.expenses,itemStyle:{normal:{color:"#0e90d2"}}},{name:"收入",type:"line",areaStyle:{normal:{}},data:t.income,itemStyle:{normal:{color:"#5eb95e"}}},{name:"盈利",type:"line",areaStyle:{normal:{}},data:t.earning,itemStyle:{normal:{color:"#dd514c"}}}]})}}},{}],identity:[function(t,e,r){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-identity").click(function(){var t=$(this);return $("#confirm-remove-identity").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1}),$(".search-isoften").change(function(){$("form").find(".am-btn").click()})},addFun:function(){$("#form-add-identity").validate()},editFun:function(){$("#form-edit-identity").validate()},uploadImg:function(t){var e=$("#form-upload-img"),r=$("#icon-image"),n=$(".upload-loading");e.submit(function(){return n.addClass("on"),$(this).ajaxSubmit({success:function(e){n.removeClass("on"),e.success&&window.parent[t](e.url)}}),!1}),r.change(function(){e.submit()})}}},{"jquery-form":12,"jquery-validate":16}],"file-manage":[function(t,e,r){"use strict";t("jquery-validate"),t("jquery-form"),e.exports={indexFun:function(){$(".remove-file-manage").click(function(){var t=$(this);return $("#confirm-remove-file-manage").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-file-manage").validate()},editFun:function(){$("#form-edit-file-manage").validate()},uploadImg:function(t){var e=$("#form-upload-img"),r=$("#icon-image"),n=$(".upload-loading");e.submit(function(){return n.addClass("on"),$(this).ajaxSubmit({success:function(e){n.removeClass("on"),e.success&&window.parent[t](e.url)}}),!1}),r.change(function(){e.submit()})}}},{"jquery-form":12,"jquery-validate":16}],earning:[function(t,e,r){"use strict";t("jquery-validate"),e.exports={indexFun:function(){var t=function(){var t=0;return $(".cell-expenses").each(function(e,r){t+=parseInt($(r).text())}),t}(),e=function(){var t=0;return $(".cell-income").each(function(e,r){t+=parseInt($(r).text())}),t}();$("#month-expenses").text(t),$("#month-income").text(e),$("#month-earning").text(e-t)},editFun:function(){$("#form-edit-earning").validate();var t=$("#expenses"),e=$("#expenses-comment"),r=/date=(.*)/.exec(location.search)[1];$(".current-day-expenses").click(function(){$.ajax({url:"/earning/edit/current-day-expenses",data:{date:r},success:function(r){t.val(r.value),e.val("采购金额:"+r.value)}})}),$("#expenses-comment,#income-comment").change(function(){var t=0,e=$(this).parent().prev().prev().find("input[type=text]"),r=this.value.match(/(\d+).*\b/g);if(!r)return void e.val(0);for(var n=0;n<r.length;n++)t+=parseInt(r[n]);e.val(t)})}}},{"jquery-validate":16}],customer:[function(t,e,r){"use strict";t("jquery-validate");var n=t("bloodhound");e.exports={indexFun:function(){var t=$("#modal-alert");$(".remove-customer").click(function(){return $("#confirm-remove-customer").modal({relatedTarget:this,onConfirm:function(e){var r=this,n=$(this.relatedTarget);$.ajax({type:"post",url:"/customer/remove/"+n.data("id"),success:function(e){e.success?location.reload():t.modal({relatedTarget:r}).find(".am-modal-bd").html('无法删除,请先删除该用户所有<a href="/order?search-customer-id='+n.data("id")+'" target="_blank">发货订单</a>后再进行删除')}})},onCancel:function(){return!1}}),!1})},addFun:function(){this.addAddress(),this.customerTypeAhead()},editFun:function(){this.addAddress(),this.customerTypeAhead()},addAddress:function(){var t=$("#content-address"),e=$(".address-add"),r=t.find(".remove");e.click(function(){var t=$(".address-field:last"),e=t.clone(!0);e.insertAfter(t),e.find(".address").val("").get(0).focus()}),r.click(function(){$(this).parents(".address-field").detach()})},customerTypeAhead:function(){var t=$("#parent-customer"),e=$("#parent-customer-id"),r=new n({datumTokenizer:n.tokenizers.obj.whitespace("value"),queryTokenizer:n.tokenizers.whitespace,remote:{url:"/customer/add/customer-parent",prepare:function(e,r){return r.data={name:t.val()},r}}});t.typeahead(null,{display:"value",highlight:!0,source:r}),t.on({"typeahead:select":function(t,r){e.val(r.customerId)},blur:function(){""===$.trim(this.value)&&e.val("")}})}}},{bloodhound:8,"jquery-validate":16}],8:[function(t,e,r){!function(n,a){"function"==typeof define&&define.amd?define("bloodhound",["jquery"],function(t){return n.Bloodhound=a(t)}):"object"==typeof r?e.exports=a(t("jquery")):n.Bloodhound=a(jQuery)}(this,function(t){var e=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},isElement:function(t){return!(!t||1!==t.nodeType)},isJQuery:function(e){return e instanceof t},toStr:function(t){return e.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,r){function n(t,e){return r(e,t)}t.each(e,n)},map:t.map,filter:t.grep,every:function(e,r){var n=!0;return e?(t.each(e,function(t,a){return(n=r.call(null,a,t,e))?void 0:!1}),!!n):n},some:function(e,r){var n=!1;return e?(t.each(e,function(t,a){return(n=r.call(null,a,t,e))?!1:void 0}),!!n):n},mixin:t.extend,identity:function(t){return t},clone:function(e){return t.extend(!0,{},e)},getIdGenerator:function(){var t=0;return function(){return t++}},templatify:function(e){function r(){return String(e)}return t.isFunction(e)?e:r},defer:function(t){setTimeout(t,0)},debounce:function(t,e,r){var n,a;return function(){var i,o,c=this,s=arguments;return i=function(){n=null,r||(a=t.apply(c,s))},o=r&&!n,clearTimeout(n),n=setTimeout(i,e),o&&(a=t.apply(c,s)),a}},throttle:function(t,e){var r,n,a,i,o,c;return o=0,c=function(){o=new Date,a=null,i=t.apply(r,n)},function(){var s=new Date,u=e-(s-o);return r=this,n=arguments,0>=u?(clearTimeout(a),a=null,o=s,i=t.apply(r,n)):a||(a=setTimeout(c,u)),i}},stringify:function(t){return e.isString(t)?t:JSON.stringify(t)},noop:function(){}}}(),r="0.11.1",n=function(){"use strict";function t(t){return t=e.toStr(t),t?t.split(/\s+/):[]}function r(t){return t=e.toStr(t),t?t.split(/\W+/):[]}function n(t){return function(r){return r=e.isArray(r)?r:[].slice.call(arguments,0),function(n){var a=[];return e.each(r,function(r){a=a.concat(t(e.toStr(n[r])))}),a}}}return{nonword:r,whitespace:t,obj:{nonword:n(r),whitespace:n(t)}}}(),a=function(){"use strict";function r(r){this.maxSize=e.isNumber(r)?r:100,this.reset(),this.maxSize<=0&&(this.set=this.get=t.noop)}function n(){this.head=this.tail=null}function a(t,e){this.key=t,this.val=e,this.prev=this.next=null}return e.mixin(r.prototype,{set:function(t,e){var r,n=this.list.tail;this.size>=this.maxSize&&(this.list.remove(n),delete this.hash[n.key],this.size--),(r=this.hash[t])?(r.val=e,this.list.moveToFront(r)):(r=new a(t,e),this.list.add(r),this.hash[t]=r,this.size++)},get:function(t){var e=this.hash[t];return e?(this.list.moveToFront(e),e.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new n}}),e.mixin(n.prototype,{add:function(t){this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},remove:function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},moveToFront:function(t){this.remove(t),this.add(t)}}),r}(),i=function(){"use strict";function r(t,r){this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix)),this.ls=r||c,!this.ls&&this._noop()}function n(){return(new Date).getTime()}function a(t){return JSON.stringify(e.isUndefined(t)?null:t)}function i(e){return t.parseJSON(e)}function o(t){var e,r,n=[],a=c.length;for(e=0;a>e;e++)(r=c.key(e)).match(t)&&n.push(r.replace(t,""));return n}var c;try{c=window.localStorage,c.setItem("~~~","!"),c.removeItem("~~~")}catch(s){c=null}return e.mixin(r.prototype,{_prefix:function(t){return this.prefix+t},_ttlKey:function(t){return this._prefix(t)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(t,e){try{this.ls.setItem(t,e)}catch(r){"QuotaExceededError"===r.name&&(this.clear(),this._noop())}},get:function(t){return this.isExpired(t)&&this.remove(t),i(this.ls.getItem(this._prefix(t)))},set:function(t,r,i){return e.isNumber(i)?this._safeSet(this._ttlKey(t),a(n()+i)):this.ls.removeItem(this._ttlKey(t)),this._safeSet(this._prefix(t),a(r))},remove:function(t){return this.ls.removeItem(this._ttlKey(t)),this.ls.removeItem(this._prefix(t)),this},clear:function(){var t,e=o(this.keyMatcher);for(t=e.length;t--;)this.remove(e[t]);return this},isExpired:function(t){var r=i(this.ls.getItem(this._ttlKey(t)));return e.isNumber(r)&&n()>r?!0:!1}}),r}(),o=function(){"use strict";function r(t){t=t||{},this.cancelled=!1,this.lastReq=null,this._send=t.transport,this._get=t.limiter?t.limiter(this._get):this._get,this._cache=t.cache===!1?new a(0):c}var n=0,i={},o=6,c=new a(10);return r.setMaxPendingRequests=function(t){o=t},r.resetCache=function(){c.reset()},e.mixin(r.prototype,{_fingerprint:function(e){return e=e||{},e.url+e.type+t.param(e.data||{})},_get:function(t,e){function r(t){e(null,t),d._cache.set(s,t)}function a(){e(!0)}function c(){n--,delete i[s],d.onDeckRequestArgs&&(d._get.apply(d,d.onDeckRequestArgs),d.onDeckRequestArgs=null)}var s,u,d=this;s=this._fingerprint(t),this.cancelled||s!==this.lastReq||((u=i[s])?u.done(r).fail(a):o>n?(n++,i[s]=this._send(t).done(r).fail(a).always(c)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(r,n){var a,i;n=n||t.noop,r=e.isString(r)?{url:r}:r||{},i=this._fingerprint(r),this.cancelled=!1,this.lastReq=i,(a=this._cache.get(i))?n(null,a):this._get(r,n)},cancel:function(){this.cancelled=!0}}),r}(),c=window.SearchIndex=function(){"use strict";function r(r){r=r||{},r.datumTokenizer&&r.queryTokenizer||t.error("datumTokenizer and queryTokenizer are both required"),this.identify=r.identify||e.stringify,this.datumTokenizer=r.datumTokenizer,this.queryTokenizer=r.queryTokenizer,this.reset()}function n(t){return t=e.filter(t,function(t){return!!t}),t=e.map(t,function(t){return t.toLowerCase()})}function a(){var t={};return t[s]=[],t[c]={},t}function i(t){for(var e={},r=[],n=0,a=t.length;a>n;n++)e[t[n]]||(e[t[n]]=!0,r.push(t[n]));return r}function o(t,e){var r=0,n=0,a=[];t=t.sort(),e=e.sort();for(var i=t.length,o=e.length;i>r&&o>n;)t[r]<e[n]?r++:t[r]>e[n]?n++:(a.push(t[r]),r++,n++);return a}var c="c",s="i";return e.mixin(r.prototype,{bootstrap:function(t){this.datums=t.datums,this.trie=t.trie},add:function(t){var r=this;t=e.isArray(t)?t:[t],e.each(t,function(t){var i,o;r.datums[i=r.identify(t)]=t,o=n(r.datumTokenizer(t)),e.each(o,function(t){var e,n,o;for(e=r.trie,n=t.split("");o=n.shift();)e=e[c][o]||(e[c][o]=a()),e[s].push(i)})})},get:function(t){var r=this;return e.map(t,function(t){return r.datums[t]})},search:function(t){var r,a,u=this;return r=n(this.queryTokenizer(t)),e.each(r,function(t){var e,r,n,i;if(a&&0===a.length)return!1;for(e=u.trie,r=t.split("");e&&(n=r.shift());)e=e[c][n];return e&&0===r.length?(i=e[s].slice(0),void(a=a?o(a,i):i)):(a=[],!1)}),a?e.map(i(a),function(t){return u.datums[t]}):[]},all:function(){var t=[];for(var e in this.datums)t.push(this.datums[e]);return t},reset:function(){this.datums={},this.trie=a()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),r}(),s=function(){"use strict";function t(t){this.url=t.url,this.ttl=t.ttl,this.cache=t.cache,this.prepare=t.prepare,this.transform=t.transform,this.transport=t.transport,this.thumbprint=t.thumbprint,this.storage=new i(t.cacheKey)}var r;return r={data:"data",protocol:"protocol",thumbprint:"thumbprint"},e.mixin(t.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(t){this.cache&&(this.storage.set(r.data,t,this.ttl),this.storage.set(r.protocol,location.protocol,this.ttl),this.storage.set(r.thumbprint,this.thumbprint,this.ttl))},fromCache:function(){var t,e={};return this.cache?(e.data=this.storage.get(r.data),e.protocol=this.storage.get(r.protocol),e.thumbprint=this.storage.get(r.thumbprint),t=e.thumbprint!==this.thumbprint||e.protocol!==location.protocol,e.data&&!t?e.data:null):null},fromNetwork:function(t){function e(){t(!0)}function r(e){t(null,a.transform(e))}var n,a=this;t&&(n=this.prepare(this._settings()),this.transport(n).fail(e).done(r))},clear:function(){return this.storage.clear(),this}}),t}(),u=function(){"use strict";function t(t){this.url=t.url,this.prepare=t.prepare,this.transform=t.transform,this.transport=new o({cache:t.cache,limiter:t.limiter,transport:t.transport})}return e.mixin(t.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(t,e){function r(t,r){e(t?[]:a.transform(r))}var n,a=this;return e?(t=t||"",n=this.prepare(t,this._settings()),this.transport.get(n,r)):void 0},cancelLastRequest:function(){this.transport.cancel()}}),t}(),d=function(){"use strict";function n(n){var a;return n?(a={url:null,ttl:864e5,cache:!0,cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null},n=e.isString(n)?{url:n}:n,n=e.mixin(a,n),!n.url&&t.error("prefetch requires url to be set"),n.transform=n.filter||n.transform,n.cacheKey=n.cacheKey||n.url,n.thumbprint=r+n.thumbprint,n.transport=n.transport?c(n.transport):t.ajax,n):null}function a(r){var n;return r?(n={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},r=e.isString(r)?{url:r}:r,r=e.mixin(n,r),!r.url&&t.error("remote requires url to be set"),r.transform=r.filter||r.transform,r.prepare=i(r),r.limiter=o(r),r.transport=r.transport?c(r.transport):t.ajax,delete r.replace,delete r.wildcard,delete r.rateLimitBy,delete r.rateLimitWait,r):void 0}function i(t){function e(t,e){return e.url=i(e.url,t),e}function r(t,e){return e.url=e.url.replace(o,encodeURIComponent(t)),e}function n(t,e){return e}var a,i,o;return a=t.prepare,i=t.replace,o=t.wildcard,a?a:a=i?e:t.wildcard?r:n}function o(t){function r(t){return function(r){return e.debounce(r,t)}}function n(t){return function(r){return e.throttle(r,t)}}var a,i,o;return a=t.limiter,i=t.rateLimitBy,o=t.rateLimitWait,a||(a=/^throttle$/i.test(i)?n(o):r(o)),a}function c(r){return function(n){function a(t){e.defer(function(){o.resolve(t)})}function i(t){e.defer(function(){o.reject(t)})}var o=t.Deferred();return r(n,a,i),o}}return function(r){var i,o;return i={initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null},r=e.mixin(i,r||{}),!r.datumTokenizer&&t.error("datumTokenizer is required"),!r.queryTokenizer&&t.error("queryTokenizer is required"),o=r.sorter,r.sorter=o?function(t){return t.sort(o)}:e.identity,r.local=e.isFunction(r.local)?r.local():r.local,r.prefetch=n(r.prefetch),r.remote=a(r.remote),r}}(),l=function(){"use strict";function r(t){t=d(t),this.sorter=t.sorter,this.identify=t.identify,this.sufficient=t.sufficient,this.local=t.local,this.remote=t.remote?new u(t.remote):null,this.prefetch=t.prefetch?new s(t.prefetch):null,this.index=new c({identify:this.identify,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer}),t.initialize!==!1&&this.initialize()}var a;return a=window&&window.Bloodhound,r.noConflict=function(){return window&&(window.Bloodhound=a),r},r.tokenizers=n,e.mixin(r.prototype,{__ttAdapter:function(){function t(t,e,n){return r.search(t,e,n)}function e(t,e){return r.search(t,e)}var r=this;return this.remote?t:e},_loadPrefetch:function(){function e(t,e){return t?r.reject():(a.add(e),a.prefetch.store(a.index.serialize()),void r.resolve())}var r,n,a=this;return r=t.Deferred(),this.prefetch?(n=this.prefetch.fromCache())?(this.index.bootstrap(n),r.resolve()):this.prefetch.fromNetwork(e):r.resolve(),r.promise()},_initialize:function(){function t(){e.add(e.local)}var e=this;return this.clear(),(this.initPromise=this._loadPrefetch()).done(t),this.initPromise},initialize:function(t){return!this.initPromise||t?this._initialize():this.initPromise},add:function(t){return this.index.add(t),this},get:function(t){return t=e.isArray(t)?t:[].slice.call(arguments),this.index.get(t)},search:function(t,r,n){function a(t){var r=[];e.each(t,function(t){!e.some(i,function(e){return o.identify(t)===o.identify(e)})&&r.push(t)}),n&&n(r)}var i,o=this;return i=this.sorter(this.index.search(t)),r(this.remote?i.slice():i),this.remote&&i.length<this.sufficient?this.remote.get(t,a):this.remote&&this.remote.cancelLastRequest(),this},all:function(){return this.index.all()},clear:function(){return this.index.reset(),this},clearPrefetchCache:function(){return this.prefetch&&this.prefetch.clear(),this},clearRemoteCache:function(){return o.resetCache(),this},ttAdapter:function(){return this.__ttAdapter()}}),r}();return l})},{jquery:15}],book:[function(t,e,r){"use strict";t("jquery-validate");var n=t("./lib/product-preview");e.exports={indexFun:function(){$(".remove-book").click(function(){var t=$(this);return $("#confirm-remove-book").modal({relatedTarget:this,onConfirm:function(e){location.href=t.attr("href")},onCancel:function(){return!1}}),!1})},addFun:function(){$("#form-add-book").validate(),this.formActionSelect()},editFun:function(){$("#form-add-book").validate(),this.formActionSelect()},previewFun:n,formActionSelect:function(){$("form :submit").click(function(){return $("form").attr({action:$(this).attr("data-action"),target:$(this).attr("data-target")}),!0})}}},{"./lib/product-preview":5,"jquery-validate":16}],5:[function(t,e,r){"use strict";e.exports=function(){var t=$(".preview-content"),e=$.trim(t.html()),r=$(".btn-copy");r.zclip({path:"/assets/swf/ZeroClipboard.swf",copy:function(){return e},afterCopy:function(){r.popover({content:"复制成功!"})}});var n=$(".btn-shot");n.button("loading");var a=$.AMUI.progress;window.onload=function(){n.button("reset"),n.click(function(){a.start(),n.button("loading").text("图片生成中..."),$.ajax({url:"/product/preview/shot",type:"post",data:{html:e,htmlHeight:t.height(),name:$("h4").text()},success:function(t){a.done(),$("#modal-shot-success").modal(),n.button("reset").text("生成淘宝详情图片")}})})}}},{}]},{},[6]);